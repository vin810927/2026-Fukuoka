<!--
  ä¹å·è³æ«»è‡ªé§• 2026ï½œå–®æª”è¡Œç¨‹ Web App
  Version: v0.5.2
  Updated: 2026-01-20 (Asia/Taipei)
  Tech: Tailwind CDN + Vue 3 (global build) + Open-Meteo

  Changelog (v0.5.2)
  - ä¿®æ­£ defaultPlan ç‰©ä»¶çµæ§‹ï¼ˆé¿å… SyntaxError: Unexpected stringï¼‰
  - å¯«å…¥ç§Ÿè»Šé ç´„ï¼šTOYOTA ç§Ÿè»Šï¼ˆC3 ç¦è¸ï¼‰
    * å–è»Šï¼š2026/03/25 13:00 ç¦å²¡ç©ºæ¸¯ï¼ˆåœ‹å…§ç·šï¼‰
    * é‚„è»Šï¼š2026/03/27 18:00 åšå¤šç«™ï¼ˆåšå¤šå£ï¼‰
    * åŠ è³¼ï¼šNOC å…é™¤ã€ETC å¡ç§Ÿç”¨
    * æé†’ï¼šé‚„è»Šå‰åŠ æ»¿æ²¹ã€å»ºè­° 17:15 å‰å›åˆ°åšå¤šç«™é™„è¿‘

  Notes:
  - æ”¯æ´ï¼šå…§å®¹å¯ç·¨è¼¯ï¼ˆcontenteditableï¼‰ï¼‹ localStorage è‡ªå‹•ä¿å­˜
  - æ”¯æ´ï¼šOpen-Meteo 5 æ—¥é å ±ï¼ˆä¾æ¯æ—¥ base åº§æ¨™ï¼‰
  - æ”¯æ´ï¼šé¤å»³å€å¡Šï¼ˆTabelog åˆ†æ•¸ / è¨‚ä½é€£çµï¼‰
  - æ”¯æ´ï¼šåˆ†äº«ï¼ˆURL Hash å£“ç¸® JSONï¼‰
  - æ”¯æ´ï¼šåŸå¸‚ç¸®åœ–é è¦½ï¼ˆOSM tiles 2Ã—2ï¼›å¤±æ•—æœƒ fallbackï¼‰

  Debug hardening:
  - é¿å…ä½¿ç”¨ template literal / replaceAll / optional chainingï¼Œé™ä½ã€ŒInvalid or unexpected tokenã€é¢¨éšª
  - åŠ å…¥ v-cloakï¼Œé¿å… Vue æœªå•Ÿå‹•æ™‚ç•«é¢å´©å£
  - åŠ å…¥ smoke testsï¼ˆconsole.assertï¼‰
-->
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¹å·è³æ«»è‡ªé§• 2026ï½œè¡Œç¨‹è¡¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Noto Sans TC", "Noto Sans JP", "Hiragino Sans", "Arial"] },
          boxShadow: { soft: "0 10px 30px rgba(0,0,0,0.08)" }
        }
      }
    }
  </script>
  <style>
    :root{ color-scheme: light; }
    [v-cloak]{ display:none; }
    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }
    .editable[contenteditable="true"]{ outline: 2px dashed rgba(120,113,108,0.35); outline-offset: 6px; border-radius: 14px; }
    .editable[contenteditable="true"]:focus{ outline-color: rgba(120,113,108,0.7); }
    .tap{ min-height:44px; }

    /* Map thumbnail */
    .tile-grid{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:2px; border-radius:16px; overflow:hidden; border:1px solid rgb(231,229,228); background:#f5f5f4; }
    .tile{ width:100%; aspect-ratio: 1 / 1; object-fit:cover; display:block; background:#f5f5f4; }
    .marker-dot{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:12px; height:12px; border-radius:999px; background:#dc2626; box-shadow:0 0 0 3px rgba(255,255,255,0.85), 0 6px 16px rgba(0,0,0,0.25); }
    .crosshair{ position:absolute; inset:0; pointer-events:none; }
    .crosshair:before,.crosshair:after{ content:""; position:absolute; background:rgba(120,113,108,0.35); }
    .crosshair:before{ left:50%; top:0; width:1px; height:100%; transform:translateX(-50%); }
    .crosshair:after{ top:50%; left:0; height:1px; width:100%; transform:translateY(-50%); }

    /* Modal stacking */
    .modal-backdrop{ background:rgba(0,0,0,0.25); }
  </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans">
  <div id="app" class="min-h-screen" v-cloak>
    <!-- Top bar -->
    <header class="sticky top-0 z-30 bg-stone-50/85 backdrop-blur border-b border-stone-200">
      <div class="max-w-3xl mx-auto px-4 py-3 flex items-center gap-3">
        <div class="flex-1">
          <div class="text-xs text-stone-500">{{ plan.meta.tripCode }}</div>
          <div class="text-lg font-semibold leading-tight editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.title')">{{ plan.meta.title }}</div>
        </div>
        <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="toggleEdit">ç·¨è¼¯ï¼š<span class="font-semibold">{{ editMode ? 'é–‹' : 'é—œ' }}</span></button>
      </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-4 pb-28">
      <!-- Meta cards -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="text-xs text-stone-500">æ—¥æœŸ</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.dateRange')">{{ plan.meta.dateRange }}</div>
          <div class="mt-2 text-xs text-stone-500">äººæ•¸</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.party')">{{ plan.meta.party }}</div>
        </div>
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="text-xs text-stone-500">äº¤é€š</div>
          <div class="mt-1 text-sm text-stone-700 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.mobility')">{{ plan.meta.mobility }}</div>
          <div class="mt-2 text-xs text-stone-500">æ”å½±</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.gear')">{{ plan.meta.gear }}</div>
        </div>
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <div class="text-xs text-stone-500">å®Œæˆåº¦</div>
              <div class="mt-1 flex items-center gap-2">
                <div class="w-full h-2 rounded-full bg-stone-200 overflow-hidden">
                  <div class="h-full bg-stone-700" :style="{width: progressPct + '%'}"></div>
                </div>
                <div class="text-xs text-stone-600 tabular-nums">{{ doneCount }}/{{ totalStops }}</div>
              </div>
              <div class="mt-2 text-xs text-stone-500">é ç®—ï¼ˆç²—ä¼°ï¼‰</div>
              <div class="mt-1 text-sm text-stone-700">
                <span class="tabular-nums">Â¥{{ totalJPY.toLocaleString() }}</span>
                <span class="text-stone-400"> / </span>
                <span class="tabular-nums">NT$ {{ totalTWD.toLocaleString() }}</span>
              </div>
            </div>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="resetDone">æ¸…é™¤å®Œæˆ</button>
          </div>
        </div>
      </section>

      <!-- Key tasks -->
      <section class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold">é—œéµä»»å‹™</div>
            <div class="text-xs text-stone-500">è¡Œç¨‹å¤–çš„æ¶ç¥¨/æ¶é ç´„ï¼Œæ”¾é€™è£¡æ¯”è¼ƒä¸æœƒå¿˜ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="addTask">ï¼‹ æ–°å¢</button>
        </div>
        <div class="mt-3 space-y-2">
          <div v-for="(t, ti) in plan.tasks" :key="t.id" class="flex items-start gap-3 p-3 rounded-2xl border border-stone-200 bg-stone-50">
            <input type="checkbox" class="mt-1 h-5 w-5 accent-stone-700" :checked="isDone('task', t.id)" @change="toggleDone('task', t.id)" />
            <div class="flex-1">
              <div class="text-sm font-medium editable" :contenteditable="editMode" @blur="onBlurText($event, 'tasks.' + ti + '.title')">{{ t.title }}</div>
              <div class="mt-1 text-xs text-stone-600 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, 'tasks.' + ti + '.note')">{{ t.note }}</div>
            </div>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="deleteTask(ti)">åˆªé™¤</button>
          </div>
        </div>
      </section>

      <!-- Weather + City preview -->
      <section id="weather" class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">å¤©æ°£ï¼ˆ5æ—¥ï¼‰</div>
            <div class="text-xs text-stone-500">è³‡æ–™ä¾†æºï¼šOpen-Meteoã€‚ä¾ã€Œç•¶å¤© base åº§æ¨™ã€å–å€¼ã€‚</div>
          </div>
          <div class="flex items-center gap-2">
            <select class="tap text-sm rounded-xl border border-stone-300 bg-white px-3 py-2" v-model.number="weatherDayIndex" @change="onChangeWeatherDay">
              <option v-for="(d, i) in plan.days" :key="d.id" :value="i">{{ d.dayLabel }} Â· {{ d.area }}</option>
            </select>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="fetchWeather">æ›´æ–°</button>
          </div>
        </div>

        <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3">
          <div class="md:col-span-1">
            <div class="text-xs text-stone-500">åŸå¸‚é è¦½</div>
            <div class="mt-2 relative">
              <div v-if="thumbError" class="p-4 rounded-2xl border border-stone-200 bg-stone-50 text-sm text-stone-600">
                ç¸®åœ–è¼‰å…¥å¤±æ•—ï¼ˆæ­¤ç’°å¢ƒå¯èƒ½æ“‹å¤–éƒ¨åœ–ç‰‡ï¼‰ã€‚
                <div class="mt-2 text-xs text-stone-500">ä½ ä»å¯ç”¨ä¸‹æ–¹ Maps/OSM é€£çµã€‚</div>
              </div>
              <div v-else class="relative">
                <div class="tile-grid">
                  <img class="tile" :src="thumbTiles[0]" @error="onThumbError" alt="map tile" loading="lazy" />
                  <img class="tile" :src="thumbTiles[1]" @error="onThumbError" alt="map tile" loading="lazy" />
                  <img class="tile" :src="thumbTiles[2]" @error="onThumbError" alt="map tile" loading="lazy" />
                  <img class="tile" :src="thumbTiles[3]" @error="onThumbError" alt="map tile" loading="lazy" />
                </div>
                <div class="crosshair"></div>
                <div class="marker-dot" aria-hidden="true"></div>
              </div>
            </div>

            <div class="mt-3 flex flex-wrap gap-2">
              <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50"
                 :href="mapsSearchUrl(currentMapLabel)" target="_blank" rel="noreferrer">Google Maps</a>
              <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50"
                 :href="osmViewUrl(currentLat, currentLon)" target="_blank" rel="noreferrer">OSM</a>
            </div>

            <div class="mt-2 text-xs text-stone-500 tabular-nums" v-if="currentLat && currentLon">
              {{ formatCoord(currentLat) }}, {{ formatCoord(currentLon) }}
            </div>
          </div>

          <div class="md:col-span-2">
            <div class="mt-0">
              <div v-if="weather.loading" class="text-sm text-stone-600">è®€å–ä¸­â€¦</div>
              <div v-else-if="weather.error" class="text-sm text-rose-700">{{ weather.error }}</div>
              <div v-else class="grid grid-cols-2 md:grid-cols-5 gap-2">
                <div v-for="(w, wi) in weather.items" :key="wi" class="p-3 rounded-2xl border border-stone-200 bg-stone-50">
                  <div class="text-xs text-stone-500">{{ w.date }}</div>
                  <div class="mt-1 text-sm font-medium">{{ w.text }}</div>
                  <div class="mt-2 text-xs text-stone-600 tabular-nums">H {{ w.tmax }}Â° / L {{ w.tmin }}Â°</div>
                  <div class="mt-1 text-xs text-stone-600">é™é›¨ {{ w.precip }} mm</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- References -->
      <section id="refs" class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="text-sm font-semibold">åƒè€ƒè³‡æ–™</div>
        <div class="mt-2 space-y-3">
          <div class="text-sm">
            <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="https://kyushu.letsgojp.com/archives/25054/" target="_blank" rel="noreferrer">æ¨‚åƒè³¼ï¼æ—¥æœ¬ï½œç¦å²¡æ«»èŠ±æ™¯é» 11 é¸</a>
            <div class="mt-2 text-xs text-stone-500">ï¼ˆç”¨æ–¼ç¦å²¡å¸‚å…§/åŒ—ä¹å·ä¸€å¸¶çš„è³æ«»é»æŸ¥è©¢èˆ‡å‚™æ¡ˆã€‚ï¼‰</div>
          </div>

          <div class="pt-2 border-t border-stone-200">
            <div class="text-xs text-stone-500">é¡å¤–è³æ«»æ™¯é»ï¼ˆå‚™æ¡ˆ / ä¸‹æ¬¡ç¦å²¡ï¼‰</div>
            <ul class="mt-2 list-disc pl-5 text-sm text-stone-700 space-y-1">
              <li>èˆé¶´å…¬åœ’ãƒ»ç¦å²¡åŸè·¡ï¼ˆèˆé¶´å…¬åœ’ï¼‰</li>
              <li>è¥¿å…¬åœ’</li>
              <li>æµ·ã®ä¸­é“æµ·æµœå…¬åœ’</li>
              <li>ç™½é‡æ±Ÿæ¤ç‰©å…¬åœ’</li>
              <li>å£ç”Ÿå…¬åœ’</li>
              <li>å°å€‰åŸ</li>
              <li>æµ…äº•ä¸€æœ¬æ¡œï¼ˆèŠ±æœŸå¯èƒ½åæ™šï¼‰</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Days -->
      <section class="mt-4 space-y-3">
        <div v-for="(day, di) in plan.days" :key="day.id" :id="'day-' + (di+1)" class="bg-white rounded-2xl shadow-soft border border-stone-200 overflow-hidden">
          <div class="p-4 border-b border-stone-200">
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="text-xs text-stone-500">{{ day.date }}</div>
                <div class="text-base font-semibold editable" :contenteditable="editMode" @blur="onBlurText($event, 'days.' + di + '.title')">{{ day.dayLabel }}ï¼š{{ day.title }}</div>
                <div class="mt-1 text-sm text-stone-600 editable" :contenteditable="editMode" @blur="onBlurText($event, 'days.' + di + '.summary')">{{ day.summary }}</div>
              </div>
              <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="openGoogleMapsDay(day)">Maps</button>
            </div>

            <div class="mt-3 flex flex-wrap gap-2 text-xs">
              <span class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Baseï¼š{{ (day.base && day.base.name) ? day.base.name : '' }}</span>
              <span class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Areaï¼š{{ day.area }}</span>
              <span v-if="day.driveHint" class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Driveï¼š{{ day.driveHint }}</span>
            </div>
          </div>

          <div class="p-4 space-y-3">
            <div v-for="(stop, si) in day.stops" :key="stop.id" class="rounded-2xl border border-stone-200 bg-stone-50 p-4">
              <div class="flex items-start gap-3">
                <input type="checkbox" class="mt-1 h-5 w-5 accent-stone-700" :checked="isDone(day.id, stop.id)" @change="toggleDone(day.id, stop.id)" />

                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-xs text-stone-500 tabular-nums" v-if="stop.time">{{ stop.time }}</span>
                    <span class="text-xs px-2 py-1 rounded-full border" :class="levelBadge(stop.level)">{{ levelText(stop.level) }}</span>
                    <span class="text-xs px-2 py-1 rounded-full border" :class="kindBadge(stop.kind)">{{ kindText(stop.kind) }}</span>
                    <span v-if="stop.bestShot" class="text-xs px-2 py-1 rounded-full border border-stone-300 bg-white">æ‹æ”ï¼š{{ stop.bestShot }}</span>
                  </div>

                  <div class="mt-2 text-sm font-semibold editable" :contenteditable="editMode" @blur="onBlurText($event, 'days.' + di + '.stops.' + si + '.title')">{{ stop.title }}</div>
                  <div v-if="stop.titleLocal" class="mt-1 text-xs text-stone-600 editable" :contenteditable="editMode" @blur="onBlurText($event, 'days.' + di + '.stops.' + si + '.titleLocal')">{{ stop.titleLocal }}</div>

                  <div class="mt-2 text-sm text-stone-700 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, 'days.' + di + '.stops.' + si + '.desc')">{{ stop.desc }}</div>

                  <div v-if="stop.lens" class="mt-2 text-xs text-stone-600 whitespace-pre-wrap">ğŸ“· {{ stop.lens }}</div>

                  <!-- Food block -->
                  <div v-if="stop.kind==='food'" class="mt-3 rounded-2xl border border-stone-200 bg-white p-3">
                    <div class="flex items-start justify-between gap-3">
                      <div class="min-w-0">
                        <div class="text-xs text-stone-500">é¤å»³</div>
                        <div class="text-sm font-semibold truncate">{{ (stop.food && stop.food.name) ? stop.food.name : 'ï¼ˆæœªå¡«ï¼‰' }}</div>
                        <div class="text-xs text-stone-600" v-if="stop.food && stop.food.nameLocal">{{ stop.food.nameLocal }}</div>
                        <div class="mt-1 text-xs text-stone-600" v-if="stop.food && stop.food.tabelogScore">Tabelogï¼š<span class="font-semibold tabular-nums">{{ stop.food.tabelogScore }}</span></div>
                      </div>
                      <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-stone-50 text-sm hover:bg-stone-100" @click="openFoodEditor(di, si)">ç·¨è¼¯é¤å»³è³‡è¨Š</button>
                    </div>

                    <div class="mt-3 flex flex-wrap gap-2">
                      <a v-if="stop.food && stop.food.tabelogUrl" class="tap inline-flex items-center px-3 py-2 rounded-xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" :href="stop.food.tabelogUrl" target="_blank" rel="noreferrer">é£Ÿã¹ãƒ­ã‚°</a>
                      <a v-if="stop.food && stop.food.reserve && stop.food.reserve.tablecheck" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="stop.food.reserve.tablecheck" target="_blank" rel="noreferrer">TableCheck è¨‚ä½</a>
                      <a v-if="stop.food && stop.food.reserve && stop.food.reserve.hotpepper" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="stop.food.reserve.hotpepper" target="_blank" rel="noreferrer">HotPepper è¨‚ä½</a>
                      <a v-if="stop.food && stop.food.reserve && stop.food.reserve.omakase" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="stop.food.reserve.omakase" target="_blank" rel="noreferrer">Omakase è¨‚ä½</a>
                      <a v-if="stop.food && stop.food.reserve && stop.food.reserve.official" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="stop.food.reserve.official" target="_blank" rel="noreferrer">å®˜æ–¹/åº—å®¶</a>
                    </div>

                    <div v-if="stop.food && stop.food.note" class="mt-2 text-xs text-stone-600 whitespace-pre-wrap">{{ stop.food.note }}</div>
                  </div>

                  <!-- Links -->
                  <div class="mt-3 flex flex-wrap gap-2">
                    <a v-if="stop.mapsQuery" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="mapsSearchUrl(stop.mapsQuery)" target="_blank" rel="noreferrer">Google Maps</a>
                    <a v-for="(lk, li) in (stop.links||[])" :key="li" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="lk.url" target="_blank" rel="noreferrer">{{ lk.label }}</a>
                  </div>

                  <div class="mt-3 text-xs text-stone-600 flex flex-wrap gap-x-4 gap-y-1">
                    <span v-if="stop.stayMins" class="tabular-nums">åœç•™ï¼š{{ stop.stayMins }} min</span>
                    <span v-if="stop.costJPY" class="tabular-nums">è²»ç”¨ï¼šÂ¥{{ Number(stop.costJPY).toLocaleString() }}</span>
                  </div>
                </div>

                <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="openStopMenu(di, si)">â‹¯</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tools -->
      <section class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="text-sm font-semibold">å·¥å…·</div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="openJson('export')">åŒ¯å‡º JSON</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="openJson('import')">åŒ¯å…¥ JSON</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="copyShare">è¤‡è£½åˆ†äº«é€£çµ</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="resetPlan">é‡ç½®ï¼ˆå›åˆ°é è¨­ï¼‰</button>
        </div>
        <div class="mt-2 text-xs text-stone-500">æé†’ï¼šæ­¤æª”æ¡ˆå¯é›¢ç·šä½¿ç”¨ï¼›è‹¥è¦ç·šä¸Šé è¦½/åˆ†äº«ï¼Œå¯æ”¾åˆ° GitHub Pages / Netlify / Vercelï¼ˆéœæ…‹ç«™ï¼‰ã€‚</div>
      </section>

      <div class="h-8"></div>
    </main>

    <!-- Bottom nav -->
    <nav class="fixed bottom-0 left-0 right-0 z-40 border-t border-stone-200 bg-stone-50/90 backdrop-blur">
      <div class="max-w-3xl mx-auto px-4 py-2 flex items-center gap-2 overflow-x-auto no-scrollbar">
        <a class="tap shrink-0 px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="#weather">å¤©æ°£</a>
        <a class="tap shrink-0 px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="#refs">åƒè€ƒ</a>
        <a v-for="(d, i) in plan.days" :key="d.id" class="tap shrink-0 px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="'#day-' + (i+1)">Day {{ i+1 }}</a>
        <button class="tap shrink-0 ml-auto px-3 py-2 rounded-xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="scrollTop">å›é ‚éƒ¨</button>
      </div>
    </nav>

    <!-- Modal backdrop (single) -->
    <div v-if="activeModal" class="fixed inset-0 z-50 flex items-end md:items-center justify-center">
      <div class="absolute inset-0 modal-backdrop" @click="closeAllModals"></div>

      <!-- Food editor modal -->
      <div v-if="activeModal==='food'" class="relative w-full md:max-w-xl bg-white rounded-t-3xl md:rounded-3xl shadow-soft border border-stone-200 p-4 md:p-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">é¤å»³è³‡è¨Š</div>
            <div class="text-xs text-stone-500">æœƒå¯«å…¥æœ¬åœ°å„²å­˜èˆ‡åˆ†äº«é€£çµã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="closeAllModals">é—œé–‰</button>
        </div>

        <div class="mt-4 grid grid-cols-1 gap-3">
          <label class="text-xs text-stone-600">é¤å»³åç¨±</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.name" />

          <label class="text-xs text-stone-600">é¤å»³åç¨±ï¼ˆæ—¥æ–‡/åŸæ–‡ï¼‰</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.nameLocal" />

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="text-xs text-stone-600">Tabelog åˆ†æ•¸</label>
              <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.tabelogScore" placeholder="ä¾‹ï¼š3.72" />
            </div>
            <div>
              <label class="text-xs text-stone-600">Tabelog é€£çµ</label>
              <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.tabelogUrl" placeholder="https://tabelog.com/..." />
            </div>
          </div>

          <label class="text-xs text-stone-600">TableCheck</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.reserve.tablecheck" placeholder="https://www.tablecheck.com/..." />

          <label class="text-xs text-stone-600">HotPepper</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.reserve.hotpepper" placeholder="https://www.hotpepper.jp/..." />

          <label class="text-xs text-stone-600">Omakase</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.reserve.omakase" placeholder="https://omakase.in/..." />

          <label class="text-xs text-stone-600">å®˜æ–¹/åº—å®¶</label>
          <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="foodForm.reserve.official" placeholder="https://..." />

          <label class="text-xs text-stone-600">å‚™è¨»</label>
          <textarea class="w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" rows="3" v-model="foodForm.note" placeholder="ä¾‹ï¼šéœ€è¦æ’éšŠ/ä¸æ¥å—é›»è©±é ç´„/å»ºè­° 18:00 å‰åˆ°â€¦"></textarea>

          <button class="tap w-full px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="saveFood">å„²å­˜</button>
        </div>
      </div>

      <!-- JSON modal -->
      <div v-if="activeModal==='json'" class="relative w-full md:max-w-2xl bg-white rounded-t-3xl md:rounded-3xl shadow-soft border border-stone-200 p-4 md:p-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">{{ jsonMode==='export' ? 'åŒ¯å‡º JSON' : 'åŒ¯å…¥ JSON' }}</div>
            <div class="text-xs text-stone-500">å¯ç”¨ä¾†æ¬ç§»/å‚™ä»½è¡Œç¨‹è³‡æ–™ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="closeAllModals">é—œé–‰</button>
        </div>
        <textarea class="mt-3 w-full rounded-2xl border border-stone-300 bg-stone-50 p-3 text-xs font-mono" rows="12" v-model="jsonText"></textarea>
        <div class="mt-3 flex gap-2">
          <button v-if="jsonMode==='export'" class="tap flex-1 px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="copyText(jsonText)">è¤‡è£½</button>
          <button v-else class="tap flex-1 px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="importJson">åŒ¯å…¥ä¸¦è¦†è“‹</button>
        </div>
      </div>

      <!-- Stop menu modal -->
      <div v-if="activeModal==='stop'" class="relative w-full md:max-w-lg bg-white rounded-t-3xl md:rounded-3xl shadow-soft border border-stone-200 p-4 md:p-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">é …ç›®è¨­å®š</div>
            <div class="text-xs text-stone-500">èª¿æ•´ç­‰ç´š/é¡å‹èˆ‡å°é‡æ•¸å€¼ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="closeAllModals">é—œé–‰</button>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-stone-600">ç­‰ç´š</label>
            <select class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.level">
              <option value="must">å¿…å»</option>
              <option value="flex">å¯èª¿æ•´</option>
              <option value="backup">å‚™æ¡ˆ</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-stone-600">é¡å‹</label>
            <select class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.kind">
              <option value="spot">æ™¯é»</option>
              <option value="food">é¤å»³</option>
              <option value="hotel">ä½å®¿</option>
              <option value="drive">è‡ªé§•/ç§»å‹•</option>
              <option value="task">ä»»å‹™</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-stone-600">åœç•™ï¼ˆminï¼‰</label>
            <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.stayMins" placeholder="60" />
          </div>
          <div>
            <label class="text-xs text-stone-600">è²»ç”¨ï¼ˆJPYï¼‰</label>
            <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.costJPY" placeholder="800" />
          </div>
        </div>

        <button class="tap mt-4 w-full px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="applyStopMenu">å„²å­˜</button>
      </div>
    </div>

    <!-- Boot message (Vue/CDN fails) -->
    <noscript>
      <div class="max-w-3xl mx-auto px-4 py-6 text-sm text-rose-700">æ­¤é éœ€è¦ JavaScript æ‰èƒ½é‹ä½œã€‚</div>
    </noscript>
  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    (function(){
      'use strict';

      // Guard: Vue must exist
      if (!window.Vue || !window.Vue.createApp) {
        try {
          var el = document.getElementById('app');
          if (el) {
            el.removeAttribute('v-cloak');
            el.innerHTML = '<div class="max-w-3xl mx-auto px-4 py-6">' +
              '<div class="text-sm font-semibold text-rose-700">Vue è¼‰å…¥å¤±æ•—</div>' +
              '<div class="mt-2 text-sm text-stone-700">å¯èƒ½æ˜¯ç¶²è·¯é˜»æ“‹ CDNï¼ˆå…¬å¸/é†«é™¢ç¶²è·¯å¸¸è¦‹ï¼‰ã€‚å»ºè­°æ”¹ç”¨å¯é€£å¤–ç¶²è·¯ï¼Œæˆ–æŠŠ Vue æ‰“åŒ…æˆæœ¬åœ°æª”æ¡ˆã€‚</div>' +
              '</div>';
          }
        } catch (e) {}
        return;
      }

      var createApp = window.Vue.createApp;

      var EXCHANGE_RATE = 4.6;
      var LS_KEY = 'kyushu_sakura_2026_plan_v2_compat';
      var LS_DONE_KEY = 'kyushu_sakura_2026_done_v2_compat';

      function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }

      // URL-safe base64 (no replaceAll)
      function b64UrlEncode(str){
        var b64 = btoa(unescape(encodeURIComponent(str)));
        return b64.replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/g,'');
      }
      function b64UrlDecode(b64url){
        var b64 = String(b64url || '').replace(/-/g,'+').replace(/_/g,'/');
        while (b64.length % 4) b64 += '=';
        return decodeURIComponent(escape(atob(b64)));
      }

      // OSM tile helpers
      function latLonToTileXY(lat, lon, z){
        var latRad = lat * Math.PI / 180;
        var n = Math.pow(2, z);
        var x = Math.floor((lon + 180) / 360 * n);
        var y = Math.floor((1 - Math.log(Math.tan(latRad) + 1/Math.cos(latRad)) / Math.PI) / 2 * n);
        return { x: x, y: y };
      }

      // --- Default plan (NO template literals) ---
      var defaultPlan = {
        meta: {
          tripCode: 'KYUSHU-SAKURA-2026',
          title: '2026 ä¹å·è³æ«»è‡ªé§•ï½œDr. Huang & å¤ªå¤ª',
          dateRange: '2026/03/25 (ä¸‰) - 2026/03/28 (å…­) Â· 4å¤©3å¤œ',
          party: '2 äººï¼ˆç„¡é•·è¼©/å°å­©ï¼‰',
          mobility:
            'å»ç¨‹ï¼šé•·æ¦® BR106 08:00 TPE â†’ 11:15 FUK\n' +
            'ç§Ÿè»Šï¼šTOYOTA ç§Ÿè»Šï¼ˆãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ï¼‰C3 ç¦è¸\n' +
            '  - å–è»Šï¼š2026/03/25ï¼ˆä¸‰ï¼‰13:00ï½œç¦å²¡ç©ºæ¸¯ï¼ˆåœ‹å…§ç·šï¼‰\n' +
            '  - é‚„è»Šï¼š2026/03/27ï¼ˆäº”ï¼‰18:00ï½œåšå¤šç«™ï¼ˆåšå¤šå£ï¼‰\n' +
            '  - åŠ è³¼ï¼šNOC å…é™¤ï¼ˆ1,650å††ï¼‰ã€ETC å¡ç§Ÿç”¨ï¼ˆ550å††ï¼‰\n' +
            '  - è²»ç”¨ï¼šåˆè¨ˆ 41,800å††ï¼ˆå«ç¨…ï¼‰\n' +
            'å›ç¨‹ï¼šé•·æ¦® BR101 20:55 FUK â†’ 22:40 TPE',
          gear: 'Sony A7CRï¼š35mm / 24-70mmï½œFUJIFILM X-T5ï¼š16-300mm',
          notes:
            'å·²ç¢ºèªä½å®¿ï¼š\n' +
            '- 3/25â€“3/27ï¼šæ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ï¼ˆKAI Asoï¼‰\n' +
            '- 3/27ï¼šä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’ï¼ˆMitsui Garden Hotel Fukuoka Gionï¼‰\n\n' +
            'æé†’ï¼š\n' +
            '- ç›´å‡æ©Ÿ / Safari / é˜ä¹³æ´ï¼šè¦–å¤©å€™èˆ‡ç•¶æ—¥ç‡Ÿé‹ï¼›è«‹ä¿ç•™ã€Œä¸æˆè¡Œ â†’ èµ°é˜¿è˜‡ç«å±±æ™¯é»ã€çš„å‚™æ¡ˆã€‚\n' +
            '- ç§Ÿè»Šé‚„è»Šï¼šå»ºè­° 17:15 å‰å›åˆ°åšå¤šç«™é™„è¿‘ï¼ˆå«å¡è»Š/åŠ æ²¹/æ•´ç†ç·©è¡ï¼‰ã€‚\n' +
            '- Day4 ç™½å¤©å¯æ’å¤ªå®°åºœï¼‹ï¼ˆå¯é¸ï¼‰é³¥æ – outletï¼Œæ™šç­å›ç¨‹ã€‚\n'
        },
        tasks: [
          {
            id: 'task-car-rental',
            title: 'ç§Ÿè»Šå·²é ç´„ï¼š3/25 13:00 FUK å–è»Š â†’ 3/27 18:00 åšå¤šç«™é‚„è»Š',
            note:
              'ç§Ÿè»Šå…¬å¸ï¼šTOYOTA ç§Ÿè»Šï¼ˆãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ï¼‰\n' +
              'è»Šå‹ç­‰ç´šï¼šã€ç¦ç…™è»Šã€‘C3ï¼ˆæˆ–åŒç´šï¼‰\n' +
              'å–è»Šï¼š2026/03/25ï¼ˆä¸‰ï¼‰13:00ï½œç¦å²¡ç©ºæ¸¯ï¼ˆåœ‹å…§ç·šï¼‰\n' +
              'é‚„è»Šï¼š2026/03/27ï¼ˆäº”ï¼‰18:00ï½œåšå¤šç«™ï¼ˆåšå¤šå£ï¼‰\n' +
              'åŠ è³¼ï¼šNOC å…é™¤ï¼ˆ1,650å††ï¼‰ã€ETC å¡ç§Ÿç”¨ï¼ˆ550å††ï¼‰\n' +
              'è²»ç”¨ï¼šåˆè¨ˆ 41,800å††ï¼ˆå«ç¨…ï¼‰\n\n' +
              'æé†’ï¼šé‚„è»Šå‰åŠ æ»¿æ²¹ï¼›å»ºè­° 17:15 å‰å›åˆ°åšå¤šç«™é™„è¿‘ï¼Œé¿å…é–€å¸‚é—œé–€èˆ‡å¡è»Šã€‚'
          },
          {
            id: 'task-kep',
            title: 'KEPï¼ˆä¹å·é«˜é€Ÿ Passï¼‰ï¼šå‡ºç™¼å‰å†ç®—ä¸€æ¬¡è¦ä¸è¦è²·',
            note:
              'ç§ŸæœŸ 3/25â€“3/27ï¼šä¸»è¦é«˜é€Ÿæ®µç‚ºã€Œç¦å²¡ç©ºæ¸¯â†”é˜¿è˜‡å‘¨é‚Šâ†”ç¦å²¡å¸‚å€ã€ã€‚\n' +
              'KEP ä¸ä¸€å®šåˆ’ç®—ï¼›å¾… Day2/Day3 ç¢ºå®šæ˜¯å¦ç¹ Safari/æ´ç©´å¾Œï¼Œå†ç”¨ã€Œé«˜é€Ÿè²» vs KEPã€æ±ºå®šã€‚'
          },
          {
            id: 'task-heli',
            title: 'é˜¿è˜‡ç«å±± ç›´å‡æ©Ÿï¼ˆãƒ˜ãƒªéŠè¦§ï¼‰ï¼šé ç´„/è²·ç¥¨ï¼ˆå€™è£œï¼‰',
            note:
              'æé†’ï¼ˆå»ºè­°ï¼‰ï¼š\n' +
              '- 2026/02/15 å‰ï¼šæ±ºå®šæ˜¯å¦è¦é£› + ç¢ºèªåƒ¹æ ¼/æ™‚æ®µ\n' +
              '- 2026/03/25â€“03/26 æ—©ä¸Šï¼šä¾å¤©å€™åˆ¤å®šæ˜¯å¦æˆè¡Œ\n\n' +
              'å€™è£œï¼ˆç¤ºä¾‹ï¼‰ï¼šARIAirï¼ˆé˜¿è˜‡éŠè¦§ï¼‰\n' +
              'https://ariair.jp/\n\n' +
              'å‚™è¨»ï¼šç•¶å¤©å¯èƒ½å› é›²éœ§/å¼·é¢¨åœé£›ï¼Œè«‹æŠŠå®ƒç•¶ã€Œæœ‰å°±è³ºåˆ°ã€çš„åŠ åˆ†é …ã€‚'
          },
          {
            id: 'task-cave',
            title: 'é˜ä¹³çŸ³æ´ï¼šå…¥å ´ç¥¨/ç‡Ÿæ¥­æ™‚é–“ç¢ºèªï¼ˆå€™è£œï¼‰',
            note:
              'æé†’ï¼ˆå»ºè­°ï¼‰ï¼š\n' +
              '- 2026/03/15ï¼šç¢ºèªç‡Ÿæ¥­æ™‚é–“/æœ€å¾Œå…¥å ´ï¼ˆå¤šæ•¸å¯ç¾å ´è³¼ç¥¨ï¼‰\n\n' +
              'å€™è£œï¼šç¨²ç©æ°´ä¸­é¾ä¹³æ´ï¼ˆInazumi Underwater Caveï¼‰\n' +
              'https://inazumi.com/\n\n' +
              'å‚™è¨»ï¼šå¾é˜¿è˜‡ç¹å»æ´ç©´é€šå¸¸æœƒå¢åŠ ç§»å‹•æ™‚é–“ï¼›è‹¥æ’äº†æ´ç©´ï¼Œç«å±±é»/å›åŸæ™‚é–“éœ€ç›¸å°ç¸®æ¸›ã€‚'
          },
          {
            id: 'task-safari',
            title: 'Safariï¼šã‚¢ãƒ•ãƒªã‚«ãƒ³ã‚µãƒ•ã‚¡ãƒª è²·ç¥¨/ã‚¸ãƒ£ãƒ³ã‚°ãƒ«ãƒã‚¹ï¼ˆå€™è£œï¼‰',
            note:
              'æé†’ï¼ˆå»ºè­°ï¼‰ï¼š\n' +
              '- 2026/02/15ï¼šæ±ºå®š MyCar Safariï¼ˆè‡ªé§•å…¥åœ’ï¼‰æˆ– Jungle Busï¼ˆé«”é©—é¤µé£Ÿï¼‰\n\n' +
              'å®˜æ–¹ï¼š\n' +
              'https://africansafari.co.jp/\n' +
              'MyCar Safariï¼š\n' +
              'https://africansafari.co.jp/safari/mycar/\n' +
              'Jungle Busï¼š\n' +
              'https://africansafari.co.jp/safari/junglebus/\n\n' +
              'å‚™è¨»ï¼šSafari æœƒè®“ Day3 è®Šæˆã€Œæ´»å‹•ï¼‹é•·è·é›¢ç§»å‹•æ—¥ã€ï¼›è«‹æ¥å—å›ç¦å²¡æ™‚é–“è¼ƒæ™šã€‚'
          }
        ],
        days: [
          {
            id: 'day1',
            dayLabel: 'Day 1',
            date: '2026/03/25ï¼ˆä¸‰ï¼‰',
            area: 'ç¦å²¡ (Fukuoka) â†’ é˜¿è˜‡ (Aso)',
            title: 'è½åœ°å–è»Š Â· ç›´å¥”é˜¿è˜‡ Â· å…¥ä½ç•Œ',
            summary: 'å…¥å¢ƒå¾Œå–è»Šä¸Šé˜¿è˜‡ã€‚ä¸‹åˆæŠŠæ™‚é–“é‚„çµ¦ç•Œï¼ˆæˆ¿å…§éœ²å¤©é¢¨å‘‚ï¼‹æ™šé¤ï¼‰ã€‚',
            driveHint: 'FUK â†’ ç•Œ é˜¿è˜‡ï¼ˆé«˜é€Ÿï¼‹å±±è·¯ï¼Œé ç•™ 15â€“25% ç·©è¡ï¼‰',
            base: { name: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', lat: 33.08069, lon: 131.193505 },
            stops: [
              {
                id: 'd1-arrival', time: '11:15', kind: 'drive', level: 'must',
                title: 'æŠµé”ï¼šç¦å²¡æ©Ÿå ´ (FUK)', titleLocal: 'ç¦å²¡ç©ºæ¸¯ (Fukuoka Airport)',
                desc: 'å…¥å¢ƒ/å–è¡Œæå¾Œï¼Œå‰å¾€ç§Ÿè»Šä¸­å¿ƒï¼ˆå–è»Šé»ç‚ºåœ‹å…§ç·šå´ï¼‰ã€‚',
                bestShot: '', lens: '', mapsQuery: 'Fukuoka Airport', links: [], stayMins: 60, costJPY: 0
              },
              {
                id: 'd1-car', time: '13:00', kind: 'drive', level: 'must',
                title: 'å–è»Šï¼šTOYOTA Rent-A-Carï¼ˆç¦å²¡ç©ºæ¸¯ãƒ»å›½å†…ç·šï¼‰',
                titleLocal: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç¦å²¡ç©ºæ¸¯ï¼ˆå›½å†…ç·šï¼‰',
                desc:
                  'å·²é ç´„ï¼šC3 ç¦è¸ã€‚\n' +
                  'åŠ è³¼ï¼šNOC å…é™¤ã€ETC å¡ç§Ÿç”¨ã€‚\n' +
                  'å–è»Šæ™‚ï¼šç¢ºèªè»Šæ³æ‹ç…§ã€ç¢ºèªåŠ æ²¹/é‚„è»Šè¦å‰‡ã€è¨­å®šå°èˆªã€‚',
                bestShot: '', lens: '', mapsQuery: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç¦å²¡ç©ºæ¸¯ å›½å†…ç·š', links: [], stayMins: 45, costJPY: 0
              },
              {
                id: 'd1-drive', time: '13:45', kind: 'drive', level: 'must',
                title: 'ç§»å‹•ï¼šç¦å²¡ â†’ é˜¿è˜‡ï¼ˆç•Œ é˜¿è˜‡ï¼‰', titleLocal: '',
                desc: 'é•·è·é›¢ç§»å‹•ï¼Œå»ºè­°è‡³å°‘å®‰æ’ 1 æ¬¡ä¼‘æ¯ç«™ã€‚',
                bestShot: '', lens: '', mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', links: [], stayMins: 180, costJPY: 0
              },
              {
                id: 'd1-kai', time: '16:30', kind: 'hotel', level: 'must',
                title: 'å…¥ä½ï¼šæ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', titleLocal: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡',
                desc: 'ä¸‹åˆç•™çµ¦æˆ¿å…§éœ²å¤©é¢¨å‘‚èˆ‡åœ’å€æ•£æ­¥ã€‚',
                bestShot: 'æ˜/å¤œ',
                lens: 'å®¤å…§ï¼š35mmï¼›åº­åœ’å±¤æ¬¡ï¼š50â€“70mmã€‚',
                mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡',
                links: [
                  { label: 'å®˜æ–¹', url: 'https://hoshinoresorts.com/ja/hotels/kaiaso/' },
                  { label: 'äº¤é€š', url: 'https://hoshinoresorts.com/ja/hotels/kaiaso/access/' }
                ],
                stayMins: 60, costJPY: 0
              }
            ]
          },
          {
            id: 'day2',
            dayLabel: 'Day 2',
            date: '2026/03/26ï¼ˆå››ï¼‰',
            area: 'é˜¿è˜‡ (Aso)',
            title: 'ç«å±±åœ°æ™¯ Â· ç›´å‡æ©Ÿå€™è£œ',
            summary: 'ä¸Šåˆçœ‹ç«å±±åœ°æ™¯ï¼›ç›´å‡æ©Ÿä½œç‚ºåŠ åˆ†é …ã€‚15:00 å‰å›ç•Œï¼Œä¸‹åˆæ³¡æ¹¯ã€‚',
            driveHint: 'é˜¿è˜‡åœˆå…§ç§»å‹•ï¼ˆç«å±±å€è¦–é¢¨å‘/ç®¡åˆ¶ï¼‰',
            base: { name: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', lat: 33.08069, lon: 131.193505 },
            stops: [
              {
                id: 'd2-daikanbo', time: '06:30', kind: 'spot', level: 'flex',
                title: 'å¤§è¦³å³° (DaikanbÅ) Â· æ—¥å‡º', titleLocal: 'å¤§è¦³å³°',
                desc: 'è‹¥å¤©å€™ç©©å®šï¼Œæ¸…æ™¨å…‰ç·šæœ€ä¹¾æ·¨ã€‚è‹¥ç–²å‹å¯ç›´æ¥ç•¥éã€‚',
                bestShot: 'æ™¨', lens: '24â€“35mm å…¨æ™¯ï¼›70mm å£“ç¸®å±±ç¨œå±¤æ¬¡ã€‚',
                mapsQuery: 'å¤§è¦³å³°', links: [], stayMins: 45, costJPY: 0
              },
              {
                id: 'd2-heli', time: '09:30', kind: 'task', level: 'flex',
                title: 'å€™è£œï¼šé˜¿è˜‡ ç«å±±ç›´å‡æ©ŸéŠè¦§ï¼ˆHelicopter Tourï¼‰', titleLocal: 'ãƒ˜ãƒªéŠè¦§',
                desc: 'è¦–å¤©å€™èˆ‡ç•¶æ—¥é‹èˆªè€Œå®šã€‚è‹¥åœé£›ï¼šæ”¹èµ°è‰åƒé‡Œ/é˜¿è˜‡ç¥ç¤¾ç­‰åœ°é¢è¡Œç¨‹ã€‚',
                bestShot: 'æ™¨/åˆå‰',
                lens: 'åº§è‰™ï¼š35mmï¼›åœ°å½¢å£“ç¸®ï¼š70mmã€‚\nåå…‰è™•ç†ï¼šé¡é ­è²¼è¿‘ç»ç’ƒã€é¿æ–œè§’ã€‚',
                mapsQuery: 'é˜¿è˜‡å±±',
                links: [ { label: 'å€™è£œï¼šARIAir', url: 'https://ariair.jp/' } ],
                stayMins: 90, costJPY: 20000
              },
              {
                id: 'd2-kusasenri', time: '11:30', kind: 'spot', level: 'must',
                title: 'è‰åƒé‡Œãƒ¶æµœ (Kusasenri-ga-hama)', titleLocal: 'è‰åƒé‡Œãƒ¶æµœ',
                desc: 'ç«å±±åœ°æ™¯çš„ä½é£½å’Œåº¦ä¸»å ´ã€‚é¢¨å¤§æ™‚æ³¨æ„ç°å¡µèˆ‡é¡é ­ä¿è­·ã€‚',
                bestShot: 'åˆå‰',
                lens: '24mm åœ°è²Œï¼‹å¤©ç©ºï¼›70mm å£“ç¸®åœ°å½¢èˆ‡é¦¬åŒ¹ã€‚\nX-T5 16â€“300mmï¼šä¸­é•·ç„¦æŠ“äººä½œå°ºåº¦ã€‚',
                mapsQuery: 'è‰åƒé‡Œãƒ¶æµœ', links: [], stayMins: 60, costJPY: 0
              },
              {
                id: 'd2-nakadake', time: '12:45', kind: 'spot', level: 'flex',
                title: 'ä¸­å²³ç«å£ (Nakadake Crater)ï¼ˆè¦–ç®¡åˆ¶ï¼‰', titleLocal: 'é˜¿è˜‡ä¸­å²³ç«å£',
                desc: 'ç«å±±æ°£é«”/é¢¨å‘å¯èƒ½è‡¨æ™‚å°é–‰ï¼Œè«‹ä»¥ç¾å ´å…¬å‘Šç‚ºæº–ã€‚',
                bestShot: 'åˆå‰/åˆå¾Œ',
                lens: '70mm å£“ç¸®ç«å£ç´‹ç†ï¼›24â€“35mm ç•™å°‘é‡å¤©ç©ºé¿å…ç°ã€‚',
                mapsQuery: 'é˜¿è˜‡å±±ä¸Šã‚¿ãƒ¼ãƒŸãƒŠãƒ«', links: [], stayMins: 45, costJPY: 0
              },
              {
                id: 'd2-lunch', time: '13:45', kind: 'food', level: 'flex',
                title: 'åˆé¤ï¼šã‚ã‹ç‰›ï¼ˆèµ¤ç‰›ä¸¼ï¼‰/ ç°¡é¤', titleLocal: 'ã‚ã‹ç‰›ä¸¼',
                desc: 'åŸå‰‡ï¼šä¸ç‚ºäº†æ’éšŠçŠ§ç‰²åˆå¾Œå›å®¿æ™‚é–“ã€‚',
                bestShot: '', lens: 'é£Ÿç‰©ï¼š35mmã€‚',
                mapsQuery: 'é˜¿è˜‡ èµ¤ç‰›ä¸¼', links: [], stayMins: 60, costJPY: 3500,
                food: { name: 'ã‚ã‹ç‰›ï¼ˆåº—å®¶å¾…å®šï¼‰', nameLocal: 'ã‚ã‹ç‰›ä¸¼', tabelogScore: '', tabelogUrl: '', reserve: { tablecheck: '', hotpepper: '', omakase: '', official: '' }, note: 'å…ˆä»¥ã€Œä¸æ’éšŠã€ç‚ºå„ªå…ˆï¼›åˆ°æ™‚å¯å†è£œ 2â€“3 é–“å€™è£œåå–®ã€‚' }
              },
              {
                id: 'd2-back', time: '15:30', kind: 'drive', level: 'must',
                title: 'å›åˆ°ç•Œé˜¿è˜‡ Â· æ³¡æ¹¯/ä¼‘æ¯', titleLocal: '',
                desc: 'æŠŠä¸‹åˆé‚„çµ¦ä½å®¿æœ¬èº«ï¼šæˆ¿å…§éœ²å¤©é¢¨å‘‚ã€æ•£æ­¥ã€æ™šé¤ã€‚',
                bestShot: 'æ˜/å¤œ', lens: '35mm éš¨æ‹ã€‚',
                mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', links: [], stayMins: 240, costJPY: 0
              }
            ]
          },
          {
            id: 'day3',
            dayLabel: 'Day 3',
            date: '2026/03/27ï¼ˆäº”ï¼‰',
            area: 'é˜¿è˜‡ â†’ï¼ˆå€™è£œï¼šSafari/æ´ï¼‰â†’ ç¦å²¡ç¥‡åœ’',
            title: 'å€™è£œæ´»å‹• Â· å›åˆ°ç¦å²¡ Â· é‚„è»Š',
            summary: 'ä¸Šåˆå¯æ“‡ä¸€ï¼šSafari / é˜ä¹³æ´ï¼ˆçš†ç‚ºç¹è·¯é¸é …ï¼‰ã€‚ä¸‹åˆå›ç¦å²¡ï¼Œ18:00 åšå¤šç«™é‚„è»Šï¼Œæ™šä¸Šå¤§æµ´å ´ï¼‹é€›è¡—ã€‚',
            driveHint: 'ç•Œ é˜¿è˜‡ â†’ ç¦å²¡ï¼ˆè‹¥ç¹ Safari/æ´ï¼Œå›åŸæ™‚é–“æœƒè®Šæ™šï¼‰',
            base: { name: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’ (Mitsui Garden Hotel Fukuoka Gion)', lat: 33.5929, lon: 130.4139 },
            stops: [
              {
                id: 'd3-checkout', time: '09:00', kind: 'hotel', level: 'must',
                title: 'é€€æˆ¿ï¼šç•Œ é˜¿è˜‡', titleLocal: '',
                desc: 'æ•´ç†è¡Œæå¾Œå‡ºç™¼ã€‚è‹¥å‰ä¸€æ™šå¤ªæ™šç¡ï¼Œå…ˆç¢ºä¿ç²¾ç¥èˆ‡å®‰å…¨é§•é§›ã€‚',
                bestShot: '', lens: '', mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', links: [], stayMins: 30, costJPY: 0
              },
              {
                id: 'd3-safari', time: '11:30', kind: 'spot', level: 'backup',
                title: 'å€™è£œï¼šã‚¢ãƒ•ãƒªã‚«ãƒ³ã‚µãƒ•ã‚¡ãƒªï¼ˆAfrican Safariï¼‰Â· MyCar Safari',
                titleLocal: 'ä¹å·è‡ªç„¶å‹•ç‰©å…¬åœ’ ã‚¢ãƒ•ãƒªã‚«ãƒ³ã‚µãƒ•ã‚¡ãƒª',
                desc: 'å¯è‡ªé§•å…¥åœ’ï¼ˆSafari Zoneï¼‰ã€‚\næ³¨æ„ï¼šé€™æœƒè®“ Day3 è®Šæˆã€Œæ´»å‹•ï¼‹é•·è·é›¢ç§»å‹•æ—¥ã€ã€‚',
                bestShot: 'åˆå‰/åˆå¾Œ',
                lens: 'X-T5 16â€“300mmï¼šå‹•ç‰©ç‰¹å¯«ï¼›è»Šå…§åå…‰è«‹æŠŠé¡é ­è²¼è¿‘ç»ç’ƒã€‚',
                mapsQuery: 'ã‚¢ãƒ•ãƒªã‚«ãƒ³ã‚µãƒ•ã‚¡ãƒª',
                links: [
                  { label: 'å®˜æ–¹', url: 'https://africansafari.co.jp/' },
                  { label: 'MyCar Safari', url: 'https://africansafari.co.jp/safari/mycar/' },
                  { label: 'Jungle Bus', url: 'https://africansafari.co.jp/safari/junglebus/' }
                ],
                stayMins: 150, costJPY: 5200
              },
              {
                id: 'd3-cave', time: '11:30', kind: 'spot', level: 'backup',
                title: 'å€™è£œï¼šç¨²ç©æ°´ä¸­é¾ä¹³æ´ï¼ˆInazumi Underwater Caveï¼‰',
                titleLocal: 'ç¨²ç©æ°´ä¸­é¾ä¹³æ´',
                desc: 'æ´ç©´å…‰ç·šåæš—ä½†è‰²èª¿ä¹¾æ·¨ã€‚\næ³¨æ„ï¼šç¹è·¯æˆæœ¬é«˜ï¼Œè‹¥è¦æ’æ´ç©´ï¼Œå»ºè­°æ”¾æ£„ Safariã€‚',
                bestShot: 'åˆå‰/åˆå¾Œ',
                lens: '35mmï¼24â€“35mmï¼›æ‰‹éœ‡æ³¨æ„ï¼ˆå¿«é–€ 1/60+ï¼‰ã€‚',
                mapsQuery: 'ç¨²ç©æ°´ä¸­é¾ä¹³æ´',
                links: [ { label: 'å®˜æ–¹', url: 'https://inazumi.com/' } ],
                stayMins: 120, costJPY: 3000
              },
              {
                id: 'd3-drive', time: '15:30', kind: 'drive', level: 'must',
                title: 'ç§»å‹•ï¼šå›åˆ°ç¦å²¡ï¼ˆåšå¤š/ç¥‡åœ’ï¼‰', titleLocal: '',
                desc: 'é€²å¸‚å€å‰å…ˆç¢ºèªæ²¹é‡èˆ‡å‰©é¤˜æ™‚é–“ï¼ˆ18:00 è¦é‚„è»Šï¼‰ã€‚å¿…è¦æ™‚æ™šé¤æ¡ã€Œåšå¤šç«™å•†åœˆã€å°±è¿‘è§£æ±ºã€‚',
                bestShot: '', lens: '', mapsQuery: 'åšå¤šé§…', links: [], stayMins: 150, costJPY: 0
              },
              {
                id: 'd3-return', time: '18:00', kind: 'drive', level: 'must',
                title: 'é‚„è»Šï¼šTOYOTA Rent-A-Carï¼ˆåšå¤šç«™ãƒ»åšå¤šå£ï¼‰',
                titleLocal: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§… åšå¤šå£',
                desc:
                  'é‚„è»Šå‰åŠ æ»¿æ²¹ã€æ•´ç†è¡Œæã€‚\n' +
                  'å»ºè­° 17:15 å‰å›åˆ°åšå¤šç«™é™„è¿‘ï¼ˆå«å¡è»Š/åŠ æ²¹ç·©è¡ï¼‰ã€‚\n' +
                  'è‹¥å»¶èª¤ï¼šå…ˆç¢ºèªé–€å¸‚æœ€æ™šå—ç†æ™‚é–“ã€‚',
                bestShot: '', lens: '', mapsQuery: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§… åšå¤šå£', links: [], stayMins: 30, costJPY: 0
              },
              {
                id: 'd3-hotel', time: '19:00', kind: 'hotel', level: 'must',
                title: 'å…¥ä½ï¼šä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’', titleLocal: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’',
                desc: '13F å¤§æµ´å ´ï¼šå…ˆæ³¡æ¹¯å›è¡€ï¼Œå†æ±ºå®šé€›è¡—/æ™šé¤ã€‚',
                bestShot: 'å¤œ', lens: 'å¤œæ™¯/è¡—æ™¯ï¼š35mmã€‚',
                mapsQuery: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’', links: [], stayMins: 30, costJPY: 0
              },
              {
                id: 'd3-dinner', time: '20:00', kind: 'food', level: 'flex',
                title: 'æ™šé¤ï¼šåšå¤šç«™å•†åœˆï¼ˆå£½å¸/ç‰›è…¸é‹/ç‡’é³¥æ“‡ä¸€ï¼‰', titleLocal: '',
                desc: 'åŸå‰‡ï¼šä¸ç‚ºäº†ååº—æŠŠæœ€å¾Œä¸€æ™šè®Šæˆæ’éšŠå¤œã€‚\nå¯ç”¨ä½ æ•´ç†çš„ã€Œç¦å²¡ç¾é£Ÿåœ°åœ–ã€æŒ‘ä¸€é–“å°±è¿‘è§£æ±ºã€‚',
                bestShot: '', lens: 'é£Ÿç‰©ï¼š35mmã€‚',
                mapsQuery: 'åšå¤šé§…', links: [], stayMins: 90, costJPY: 9000,
                food: { name: 'æ™šé¤å€™è£œï¼ˆå¾…å®šï¼‰', nameLocal: '', tabelogScore: '', tabelogUrl: '', reserve: { tablecheck: '', hotpepper: '', omakase: '', official: '' }, note: 'è‹¥æƒ³åƒ Omakaseï¼Œæˆ‘å¯ä»¥å†è£œã€Œåšå¤šç«™/ç¥‡åœ’æ­¥è¡Œåœˆã€2â€“3 é–“å€™è£œï¼‹è¨‚ä½é€£çµã€‚' }
              }
            ]
          },
          {
            id: 'day4',
            dayLabel: 'Day 4',
            date: '2026/03/28ï¼ˆå…­ï¼‰',
            area: 'å¤ªå®°åºœ â†’ï¼ˆå¯é¸ï¼‰é³¥æ – outlet â†’ FUK',
            title: 'å¤ªå®°åºœ Â· é€›è¡— Â· æ™šç­å›ç¨‹',
            summary: 'æ—©ä¸Šå¤ªå®°åºœåƒæ‹œï¼›ä¸‹åˆè¦–é«”åŠ›å»é³¥æ – Premium Outletsï¼›æ™šç­ BR101 å›å°ã€‚',
            driveHint: 'Day4 å»ºè­°ç”¨é›»è»Šï¼ˆè»Šå·²æ–¼ 3/27 18:00 é‚„æ‰ï¼‰',
            base: { name: 'ç¦å²¡ï¼ˆç¥‡åœ’ï¼‰', lat: 33.5929, lon: 130.4139 },
            stops: [
              {
                id: 'd4-dazaifu', time: '09:00', kind: 'spot', level: 'must',
                title: 'å¤ªå®°åºœå¤©æº€å®® (Dazaifu TenmangÅ«)', titleLocal: 'å¤ªå®°åºœå¤©æº€å®®',
                desc: 'ä¸Šåˆå…ˆå»ï¼Œé¿é–‹äººæ½®ã€‚å¯é †ä¾¿è²·æ¢…ãƒ¶æé¤…ã€‚',
                bestShot: 'æ™¨/åˆå‰', lens: '35mm èµ°æ‹ï¼›70mm å£“ç¸®åƒé“èˆ‡é³¥å±…ã€‚',
                mapsQuery: 'å¤ªå®°åºœå¤©æº€å®®', links: [], stayMins: 120, costJPY: 0
              },
              {
                id: 'd4-kamado', time: '11:30', kind: 'spot', level: 'flex',
                title: 'å®æº€å®®ç«ˆé–€ç¥ç¤¾ (Kamado Shrine)ï¼ˆå¯é¸ï¼‰', titleLocal: 'å®æº€å®®ç«ˆé–€ç¥ç¤¾',
                desc: 'è‹¥æƒ³è£œæ™¯è‰²èˆ‡å®‰éœæ°›åœï¼Œå¯åŠ ä¸€å€‹ç¥ç¤¾é»ã€‚',
                bestShot: 'åˆå‰/åˆå¾Œ', lens: '24â€“35mmï¼›é™°å¤©ä¹Ÿå¥½æ‹ã€‚',
                mapsQuery: 'å®æº€å®®ç«ˆé–€ç¥ç¤¾', links: [], stayMins: 60, costJPY: 0
              },
              {
                id: 'd4-outlet', time: '13:30', kind: 'spot', level: 'flex',
                title: 'é³¥æ –ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ (Tosu Premium Outlets)', titleLocal: 'é³¥æ –ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ',
                desc: 'ä½œç‚ºã€Œé€›è¡—ä¸»èœã€ã€‚è‹¥ä¸æƒ³æ‹‰è»Šç¨‹ï¼Œå¯æ”¹é€›åšå¤šç«™å•†åœˆã€‚',
                bestShot: '', lens: 'è¡—æ‹ï¼š35mmï¼›æƒ³å£“ç¸®äººæµå¯ç”¨ 70mmã€‚',
                mapsQuery: 'é³¥æ –ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ', links: [], stayMins: 150, costJPY: 0
              },
              {
                id: 'd4-airport', time: '18:00', kind: 'drive', level: 'must',
                title: 'å‰å¾€ç¦å²¡æ©Ÿå ´ (FUK)', titleLocal: 'ç¦å²¡ç©ºæ¸¯',
                desc: 'è‹¥è¦é€€ç¨…/æ‰˜é‹ï¼Œå»ºè­°è‡³å°‘èµ·é£›å‰ 2 å°æ™‚æŠµé”ã€‚',
                bestShot: '', lens: '', mapsQuery: 'Fukuoka Airport', links: [], stayMins: 120, costJPY: 0
              },
              {
                id: 'd4-flight', time: '20:55', kind: 'drive', level: 'must',
                title: 'å›ç¨‹ï¼šBR101 ç¦å²¡(FUK) â†’ å°åŒ—(TPE)', titleLocal: 'EVA Air BR101',
                desc: 'å·²é–å®šæ™šç­å›ç¨‹ï¼š20:55â€“22:40ã€‚',
                bestShot: '', lens: '', mapsQuery: 'Fukuoka Airport', links: [], stayMins: 0, costJPY: 0
              }
            ]
          }
        ]
      };

      createApp({
        data: function(){
          return {
            editMode: false,
            plan: deepClone(defaultPlan),
            doneMap: {},
            weatherDayIndex: 0,
            weather: { loading: false, error: '', items: [] },

            // modal state
            activeModal: null,
            modalRef: { di: -1, si: -1 },

            // food form
            foodForm: {
              name: '',
              nameLocal: '',
              tabelogScore: '',
              tabelogUrl: '',
              reserve: { tablecheck: '', hotpepper: '', omakase: '', official: '' },
              note: ''
            },

            // stop menu
            stopMenu: { level: 'must', kind: 'spot', stayMins: '', costJPY: '' },

            // json modal
            jsonMode: 'export',
            jsonText: '',

            // city preview
            thumbZoom: 12,
            thumbError: false
          };
        },
        computed: {
          totalStops: function(){
            var i;
            var dayStops = 0;
            for (i = 0; i < this.plan.days.length; i++) dayStops += (this.plan.days[i].stops ? this.plan.days[i].stops.length : 0);
            var taskStops = this.plan.tasks ? this.plan.tasks.length : 0;
            return dayStops + taskStops;
          },
          doneCount: function(){
            var k, n = 0;
            for (k in this.doneMap) if (this.doneMap.hasOwnProperty(k) && this.doneMap[k]) n++;
            return n;
          },
          progressPct: function(){
            if (!this.totalStops) return 0;
            return Math.round((this.doneCount / this.totalStops) * 100);
          },
          totalJPY: function(){
            var sum = 0;
            for (var i = 0; i < this.plan.days.length; i++) {
              var stops = this.plan.days[i].stops || [];
              for (var j = 0; j < stops.length; j++) sum += Number(stops[j].costJPY || 0);
            }
            return Math.round(sum);
          },
          totalTWD: function(){
            return Math.round(this.totalJPY * EXCHANGE_RATE);
          },
          currentDay: function(){
            return this.plan.days[this.weatherDayIndex] || this.plan.days[0];
          },
          currentLat: function(){
            var d = this.currentDay;
            return d && d.base ? Number(d.base.lat) : 0;
          },
          currentLon: function(){
            var d = this.currentDay;
            return d && d.base ? Number(d.base.lon) : 0;
          },
          currentMapLabel: function(){
            var d = this.currentDay || {};
            if (d.base && d.base.name) return d.base.name;
            return d.area || 'Kyushu';
          },
          thumbTiles: function(){
            var lat = Number(this.currentLat);
            var lon = Number(this.currentLon);
            if (!isFinite(lat) || !isFinite(lon) || (lat === 0 && lon === 0)) return ['', '', '', ''];
            var z = this.thumbZoom;
            var xy = latLonToTileXY(lat, lon, z);
            var x = xy.x, y = xy.y;
            var base = 'https://tile.openstreetmap.org';
            return [
              base + '/' + z + '/' + x + '/' + y + '.png',
              base + '/' + z + '/' + (x+1) + '/' + y + '.png',
              base + '/' + z + '/' + x + '/' + (y+1) + '.png',
              base + '/' + z + '/' + (x+1) + '/' + (y+1) + '.png'
            ];
          }
        },
        mounted: function(){
          this.loadFromHashOrLocal();
          this.loadDone();
          this.fetchWeather();
          var self = this;
          window.addEventListener('hashchange', function(){ self.loadFromHashOrLocal(); });
        },
        methods: {
          // --- Badges ---
          kindText: function(kind){
            var map = { spot:'æ™¯é»', food:'é¤å»³', hotel:'ä½å®¿', drive:'ç§»å‹•', task:'ä»»å‹™' };
            return map[kind] || kind;
          },
          levelText: function(level){
            var map = { must:'å¿…å»', flex:'å¯èª¿æ•´', backup:'å‚™æ¡ˆ' };
            return map[level] || level;
          },
          kindBadge: function(kind){
            var map = {
              spot:'border-stone-300 bg-white text-stone-700',
              food:'border-stone-300 bg-white text-stone-700',
              hotel:'border-stone-300 bg-white text-stone-700',
              drive:'border-stone-300 bg-white text-stone-700',
              task:'border-stone-300 bg-white text-stone-700'
            };
            return map[kind] || 'border-stone-300 bg-white text-stone-700';
          },
          levelBadge: function(level){
            var map = {
              must:'border-stone-700 bg-stone-800 text-stone-50',
              flex:'border-stone-300 bg-white text-stone-700',
              backup:'border-stone-300 bg-stone-100 text-stone-700'
            };
            return map[level] || 'border-stone-300 bg-white text-stone-700';
          },

          // --- City preview ---
          onThumbError: function(){ this.thumbError = true; },
          onChangeWeatherDay: function(){ this.thumbError = false; this.fetchWeather(); },
          formatCoord: function(n){
            var v = Number(n);
            if (!isFinite(v)) return '';
            return v.toFixed(5);
          },

          // --- Editable helpers ---
          toggleEdit: function(){ this.editMode = !this.editMode; },
          onBlurText: function(evt, path){
            if(!this.editMode) return;
            var value = (evt && evt.target && typeof evt.target.innerText === 'string') ? evt.target.innerText : '';
            value = value.replace(/\s+$/,'');
            this.setByPath(path, value);
            this.persist();
          },
          setByPath: function(path, value){
            var segs = String(path || '').split('.');
            var cur = this.plan;
            for (var i = 0; i < segs.length - 1; i++) {
              var k = segs[i];
              if (cur == null || typeof cur !== 'object') return;
              cur = cur[k];
            }
            if (cur && segs.length) cur[segs[segs.length - 1]] = value;
          },

          // --- Done state ---
          doneKey: function(dayId, stopId){ return String(dayId) + '::' + String(stopId); },
          loadDone: function(){
            try {
              var raw = localStorage.getItem(LS_DONE_KEY);
              this.doneMap = raw ? JSON.parse(raw) : {};
            } catch (e) { this.doneMap = {}; }
          },
          saveDone: function(){
            try { localStorage.setItem(LS_DONE_KEY, JSON.stringify(this.doneMap)); } catch (e) {}
          },
          isDone: function(dayId, stopId){
            return !!this.doneMap[this.doneKey(dayId, stopId)];
          },
          toggleDone: function(dayId, stopId){
            var k = this.doneKey(dayId, stopId);
            this.doneMap[k] = !this.doneMap[k];
            this.saveDone();
          },
          resetDone: function(){
            this.doneMap = {};
            this.saveDone();
          },

          // --- Weather ---
          weatherCodeToText: function(code){
            if(code === 0) return 'æ™´';
            if([1,2,3].indexOf(code) >= 0) return 'å¤šé›²';
            if([45,48].indexOf(code) >= 0) return 'éœ§';
            if([51,53,55,56,57].indexOf(code) >= 0) return 'æ¯›æ¯›é›¨';
            if([61,63,65,66,67].indexOf(code) >= 0) return 'é›¨';
            if([71,73,75,77].indexOf(code) >= 0) return 'é›ª';
            if([80,81,82].indexOf(code) >= 0) return 'é™£é›¨';
            if([95,96,99].indexOf(code) >= 0) return 'é›·é›¨';
            return 'ä¸æ˜';
          },
          fetchWeather: function(){
            var self = this;
            var d = this.plan.days[this.weatherDayIndex] || this.plan.days[0];
            if (!d || !d.base || !d.base.lat || !d.base.lon) return;
            this.weather.loading = true;
            this.weather.error = '';

            var url = 'https://api.open-meteo.com/v1/forecast' +
              '?latitude=' + encodeURIComponent(d.base.lat) +
              '&longitude=' + encodeURIComponent(d.base.lon) +
              '&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum' +
              '&timezone=Asia%2FTokyo';

            fetch(url).then(function(res){
              if(!res.ok) throw new Error('weather fetch failed');
              return res.json();
            }).then(function(json){
              var dates = (json.daily && json.daily.time) ? json.daily.time : [];
              var code = (json.daily && json.daily.weathercode) ? json.daily.weathercode : [];
              var tmax = (json.daily && json.daily.temperature_2m_max) ? json.daily.temperature_2m_max : [];
              var tmin = (json.daily && json.daily.temperature_2m_min) ? json.daily.temperature_2m_min : [];
              var p = (json.daily && json.daily.precipitation_sum) ? json.daily.precipitation_sum : [];

              self.weather.items = dates.slice(0,5).map(function(dt, i){
                return {
                  date: dt,
                  text: self.weatherCodeToText(code[i]),
                  tmax: Math.round((tmax[i] != null) ? tmax[i] : 0),
                  tmin: Math.round((tmin[i] != null) ? tmin[i] : 0),
                  precip: Math.round(((p[i] != null) ? p[i] : 0) * 10) / 10
                };
              });
            }).catch(function(){
              self.weather.error = 'å¤©æ°£è®€å–å¤±æ•—ï¼ˆå¯èƒ½æ˜¯ç¶²è·¯/é˜»æ“‹è·¨åŸŸï¼‰ã€‚';
            }).finally(function(){
              self.weather.loading = false;
            });
          },

          // --- Maps ---
          mapsSearchUrl: function(q){
            return 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(q || '');
          },
          osmViewUrl: function(lat, lon){
            var la = Number(lat);
            var lo = Number(lon);
            if(!isFinite(la) || !isFinite(lo) || (la === 0 && lo === 0)) return 'https://www.openstreetmap.org/';
            return 'https://www.openstreetmap.org/?mlat=' + encodeURIComponent(la) + '&mlon=' + encodeURIComponent(lo) + '#map=14/' + encodeURIComponent(la) + '/' + encodeURIComponent(lo);
          },
          openGoogleMapsDay: function(day){
            var points = [];
            if (day && day.base && day.base.name) points.push(day.base.name);
            var stops = (day && day.stops) ? day.stops : [];
            for (var i = 0; i < stops.length; i++) if (stops[i].mapsQuery) points.push(stops[i].mapsQuery);
            if (points.length < 2) {
              window.open(this.mapsSearchUrl((day && day.base && day.base.name) ? day.base.name : (day ? day.area : 'Kyushu')), '_blank', 'noreferrer');
              return;
            }
            var origin = points[0];
            var destination = points[points.length - 1];
            var waypoints = points.slice(1, -1).join('|');
            var url = 'https://www.google.com/maps/dir/?api=1' +
              '&origin=' + encodeURIComponent(origin) +
              '&destination=' + encodeURIComponent(destination) +
              '&travelmode=driving' +
              '&waypoints=' + encodeURIComponent(waypoints);
            window.open(url, '_blank', 'noreferrer');
          },

          // --- Modal control ---
          closeAllModals: function(){
            this.activeModal = null;
            this.modalRef = { di: -1, si: -1 };
          },

          // --- Food editor ---
          openFoodEditor: function(di, si){
            this.closeAllModals();
            var stop = this.plan.days[di].stops[si];
            if (!stop.food) {
              stop.food = { name:'', nameLocal:'', tabelogScore:'', tabelogUrl:'', reserve:{tablecheck:'',hotpepper:'',omakase:'',official:''}, note:'' };
            }
            this.modalRef = { di: di, si: si };
            this.foodForm = JSON.parse(JSON.stringify(stop.food));
            this.activeModal = 'food';
          },
          saveFood: function(){
            var di = this.modalRef.di;
            var si = this.modalRef.si;
            if (di < 0 || si < 0) return;
            var stop = this.plan.days[di].stops[si];
            stop.food = JSON.parse(JSON.stringify(this.foodForm));
            this.persist();
            this.closeAllModals();
          },

          // --- Stop menu ---
          openStopMenu: function(di, si){
            this.closeAllModals();
            var stop = this.plan.days[di].stops[si];
            this.modalRef = { di: di, si: si };
            this.stopMenu = {
              level: stop.level || 'must',
              kind: stop.kind || 'spot',
              stayMins: stop.stayMins ? String(stop.stayMins) : '',
              costJPY: stop.costJPY ? String(stop.costJPY) : ''
            };
            this.activeModal = 'stop';
          },
          applyStopMenu: function(){
            var di = this.modalRef.di;
            var si = this.modalRef.si;
            if (di < 0 || si < 0) return;
            var stop = this.plan.days[di].stops[si];
            stop.level = this.stopMenu.level;
            stop.kind = this.stopMenu.kind;
            stop.stayMins = this.stopMenu.stayMins ? Number(this.stopMenu.stayMins) : 0;
            stop.costJPY = this.stopMenu.costJPY ? Number(this.stopMenu.costJPY) : 0;
            this.persist();
            this.closeAllModals();
          },

          // --- JSON import/export ---
          openJson: function(mode){
            this.closeAllModals();
            this.jsonMode = mode;
            this.jsonText = (mode === 'export') ? JSON.stringify(this.plan, null, 2) : '';
            this.activeModal = 'json';
          },
          importJson: function(){
            try {
              var obj = JSON.parse(this.jsonText);
              this.plan = obj;
              this.persist();
              this.weatherDayIndex = 0;
              this.thumbError = false;
              this.fetchWeather();
              this.closeAllModals();
            } catch (e) {
              alert('JSON æ ¼å¼éŒ¯èª¤');
            }
          },
          copyText: function(text){
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(text).then(function(){ alert('å·²è¤‡è£½'); }).catch(function(){ alert('è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰ã€‚'); });
              return;
            }
            // fallback
            try {
              var ta = document.createElement('textarea');
              ta.value = text;
              ta.style.position = 'fixed';
              ta.style.left = '-9999px';
              document.body.appendChild(ta);
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              alert('å·²è¤‡è£½');
            } catch (e) { alert('è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰ã€‚'); }
          },

          // --- Share (hash) ---
          setHashFromPlan: function(){
            try {
              var str = JSON.stringify(this.plan);
              var enc = b64UrlEncode(str);
              location.hash = '#p=' + enc;
            } catch (e) {}
          },
          copyShare: function(){
            this.setHashFromPlan();
            this.copyText(location.href);
          },

          // --- Persistence ---
          persist: function(){
            try { localStorage.setItem(LS_KEY, JSON.stringify(this.plan)); } catch (e) {}
          },
          loadFromHashOrLocal: function(){
            var h = location.hash || '';
            var m = h.match(/#p=([^&]+)/);
            if (m && m[1]) {
              try {
                var str = b64UrlDecode(m[1]);
                var obj = JSON.parse(str);
                this.plan = obj;
                this.persist();
                this.thumbError = false;
                return;
              } catch (e) {}
            }
            try {
              var raw = localStorage.getItem(LS_KEY);
              this.plan = raw ? JSON.parse(raw) : deepClone(defaultPlan);
            } catch (e) {
              this.plan = deepClone(defaultPlan);
            }
            this.thumbError = false;
          },
          resetPlan: function(){
            if(!confirm('ç¢ºå®šè¦é‡ç½®ç‚ºé è¨­è¡Œç¨‹ï¼Ÿï¼ˆæœƒè¦†è“‹ç›®å‰ä¿®æ”¹ï¼‰')) return;
            this.plan = deepClone(defaultPlan);
            this.persist();
            this.weatherDayIndex = 0;
            this.thumbError = false;
            this.fetchWeather();
            try { history.replaceState(null, '', location.pathname + location.search); } catch (e) {}
          },

          // --- Tasks ---
          addTask: function(){
            this.plan.tasks.push({ id: 'task-' + Date.now(), title: 'æ–°ä»»å‹™', note: 'ï¼ˆé»ç·¨è¼¯å¾Œå¯ä¿®æ”¹ï¼‰' });
            this.persist();
          },
          deleteTask: function(i){
            if(!confirm('åˆªé™¤æ­¤ä»»å‹™ï¼Ÿ')) return;
            var t = this.plan.tasks[i];
            try { delete this.doneMap[this.doneKey('task', t.id)]; } catch (e) {}
            this.plan.tasks.splice(i, 1);
            this.persist();
            this.saveDone();
          },

          // --- Misc ---
          scrollTop: function(){ window.scrollTo({ top: 0, behavior: 'smooth' }); }
        }
      }).mount('#app');

      // =========================
      // Smoke tests (console)
      // =========================
      (function runSmokeTests(){
        try {
          console.assert(typeof b64UrlEncode('x') === 'string', 'b64UrlEncode should return string');
          console.assert(b64UrlDecode(b64UrlEncode('hello')) === 'hello', 'b64Url roundtrip');
          var t = latLonToTileXY(33.59, 130.42, 12);
          console.assert(typeof t.x === 'number' && typeof t.y === 'number', 'tile conversion returns numbers');
          console.assert(defaultPlan && defaultPlan.meta && typeof defaultPlan.meta.mobility === 'string', 'defaultPlan.meta.mobility should be string');
          console.assert(defaultPlan.days && defaultPlan.days.length >= 4, 'defaultPlan should have >= 4 days');
          console.assert(defaultPlan.tasks && defaultPlan.tasks.length >= 3, 'defaultPlan should have >= 3 tasks');
          console.assert(defaultPlan.tasks[0] && defaultPlan.tasks[0].title, 'first task should exist');
        } catch (e) {
          console.warn('Smoke tests failed:', e);
        }
      })();

    })();
  </script>
</body>
</html>
