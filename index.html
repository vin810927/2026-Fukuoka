<!--
  ä¹å·è³æ«»è‡ªé§• 2026ï½œå–®æª”è¡Œç¨‹ Web App
  Version: v0.5.2
  Updated: 2026-02-03 (Asia/Taipei)
  Tech: Tailwind CDN + Vue 3 (global build) + Open-Meteo

  ä¿®æ­£ï¼š
  - ç§»é™¤èª¤æ¤çš„ $1/$2 ä½”ä½ç¬¦ï¼Œé¿å… ReferenceErrorã€‚
  - å¼·åŒ– migratePlanï¼šè‹¥ Day 3ï¼ˆé«˜åƒç©—ï¼‰æˆ–ä»»å‹™ç¼ºå¤±ï¼Œæœƒè‡ªå‹•è£œé½Šã€‚
-->
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¹å·è³æ«»è‡ªé§• 2026ï½œè¡Œç¨‹è¡¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Noto Sans TC", "Noto Sans JP", "Hiragino Sans", "Arial"] },
          boxShadow: { soft: "0 10px 30px rgba(0,0,0,0.08)" }
        }
      }
    }
  </script>
  <style>
    :root{ color-scheme: light; }
    .no-scrollbar::-webkit-scrollbar{ display:none; }
    .no-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }
    .editable[contenteditable="true"]{ outline: 2px dashed rgba(120,113,108,0.35); outline-offset: 6px; border-radius: 14px; }
    .editable[contenteditable="true"]:focus{ outline-color: rgba(120,113,108,0.7); }
    .tap{ min-height:44px; }
  </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans">
  <div id="app" class="min-h-screen">
    <header class="sticky top-0 z-30 bg-stone-50/85 backdrop-blur border-b border-stone-200">
      <div class="max-w-3xl mx-auto px-4 py-3 flex items-center gap-3">
        <div class="flex-1">
          <div class="text-xs text-stone-500">{{ plan.meta.tripCode }}</div>
          <div class="text-lg font-semibold leading-tight editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.title')">{{ plan.meta.title }}</div>
        </div>
        <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="toggleEdit">
          ç·¨è¼¯ï¼š<span class="font-semibold">{{ editMode ? 'é–‹' : 'é—œ' }}</span>
        </button>
      </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-4 pb-28">
      <section class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="text-xs text-stone-500">æ—¥æœŸ</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.dateRange')">{{ plan.meta.dateRange }}</div>
          <div class="mt-2 text-xs text-stone-500">äººæ•¸</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.party')">{{ plan.meta.party }}</div>
        </div>
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="text-xs text-stone-500">äº¤é€š</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.mobility')">{{ plan.meta.mobility }}</div>
          <div class="mt-2 text-xs text-stone-500">æ”å½±</div>
          <div class="mt-1 text-sm text-stone-700 editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.gear')">{{ plan.meta.gear }}</div>
        </div>
        <div class="bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <div class="text-xs text-stone-500">å®Œæˆåº¦</div>
              <div class="mt-1 flex items-center gap-2">
                <div class="w-full h-2 rounded-full bg-stone-200 overflow-hidden">
                  <div class="h-full bg-stone-700" :style="{width: progressPct + '%'}"></div>
                </div>
                <div class="text-xs text-stone-600 tabular-nums">{{ doneCount }}/{{ totalStops }}</div>
              </div>
              <div class="mt-2 text-xs text-stone-500">é ç®—ï¼ˆç²—ä¼°ï¼‰</div>
              <div class="mt-1 text-sm text-stone-700">
                <span class="tabular-nums">Â¥{{ totalJPY.toLocaleString() }}</span>
                <span class="text-stone-400"> / </span>
                <span class="tabular-nums">NT$ {{ totalTWD.toLocaleString() }}</span>
              </div>
            </div>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="resetDone">æ¸…é™¤å®Œæˆ</button>
          </div>
        </div>
      </section>

      <section class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold">é—œéµä»»å‹™</div>
            <div class="text-xs text-stone-500">è¡Œç¨‹å¤–çš„æ¶ç¥¨/æ¶é ç´„ï¼Œæ”¾é€™è£¡æ¯”è¼ƒä¸æœƒå¿˜ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="addTask">ï¼‹ æ–°å¢</button>
        </div>
        <div class="mt-3 space-y-2">
          <div v-for="(t, ti) in plan.tasks" :key="t.id" class="flex items-start gap-3 p-3 rounded-2xl border border-stone-200 bg-stone-50">
            <input type="checkbox" class="mt-1 h-5 w-5 accent-stone-700" :checked="isDone('task', t.id)" @change="toggleDone('task', t.id)" />
            <div class="flex-1">
              <div class="text-sm font-medium editable" :contenteditable="editMode" @blur="onBlurText($event, `tasks.${ti}.title`)">{{ t.title }}</div>
              <div class="mt-1 text-xs text-stone-600 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, `tasks.${ti}.note`)">{{ t.note }}</div>
            </div>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="deleteTask(ti)">åˆªé™¤</button>
          </div>
        </div>
      </section>

      <section id="weather" class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="flex items-center justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">å¤©æ°£ï¼ˆ5æ—¥ï¼‰</div>
            <div class="text-xs text-stone-500">è³‡æ–™ä¾†æºï¼šOpen-Meteoã€‚ä¾ã€Œç•¶å¤© base åº§æ¨™ã€å–å€¼ã€‚</div>
          </div>
          <div class="flex items-center gap-2">
            <select class="tap text-sm rounded-xl border border-stone-300 bg-white px-3 py-2" v-model.number="weatherDayIndex" @change="fetchWeather">
              <option v-for="(d, i) in plan.days" :key="d.id" :value="i">{{ d.dayLabel }} Â· {{ d.area }}</option>
            </select>
            <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="fetchWeather">æ›´æ–°</button>
          </div>
        </div>

        <div class="mt-3">
          <div v-if="weather.loading" class="text-sm text-stone-600">è®€å–ä¸­â€¦</div>
          <div v-else-if="weather.error" class="text-sm text-rose-700">{{ weather.error }}</div>
          <div v-else class="grid grid-cols-2 md:grid-cols-5 gap-2">
            <div v-for="(w, wi) in weather.items" :key="wi" class="p-3 rounded-2xl border border-stone-200 bg-stone-50">
              <div class="text-xs text-stone-500">{{ w.date }}</div>
              <div class="mt-1 text-sm font-medium">{{ w.text }}</div>
              <div class="mt-2 text-xs text-stone-600 tabular-nums">H {{ w.tmax }}Â° / L {{ w.tmin }}Â°</div>
              <div class="mt-1 text-xs text-stone-600">é™é›¨ {{ w.precip }} mm</div>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="text-sm font-semibold">å‚™å¿˜</div>
        <div class="mt-2 text-sm text-stone-700 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, 'meta.notes')">{{ plan.meta.notes }}</div>
      </section>

      <section class="mt-3 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="text-sm font-semibold">åƒè€ƒè³‡æ–™</div>
        <div class="mt-2 text-xs text-stone-600">ï¼ˆç”¨æ–¼ç¦å²¡å¸‚å…§ / åŒ—ä¹å·ä¸€å¸¶çš„è³æ«»é»æŸ¥è©¢èˆ‡å‚™æ¡ˆã€‚ï¼‰</div>

        <div class="mt-3 flex flex-wrap gap-2">
          <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="https://kyushu.letsgojp.com/archives/25054/" target="_blank" rel="noreferrer">æ¨‚åƒè³¼ï¼æ—¥æœ¬ï½œç¦å²¡æ«»èŠ±æ™¯é» 11 é¸</a>
          <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="https://weathernews.jp/sakura/" target="_blank" rel="noreferrer">èŠ±æ³æŸ¥è©¢ï¼šã‚¦ã‚§ã‚¶ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ æ¡œ</a>
          <a class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="https://tenki.jp/sakura/" target="_blank" rel="noreferrer">èŠ±æ³æŸ¥è©¢ï¼štenki.jp æ¡œ</a>
        </div>

        <div class="mt-4 pt-3 border-t border-stone-200">
          <div class="text-xs text-stone-500">é¡å¤–è³æ«»æ™¯é»ï¼ˆå‚™æ¡ˆ / ä¸‹æ¬¡ç¦å²¡ï¼‰</div>
          <ul class="mt-2 text-sm text-stone-700 space-y-1 list-disc pl-5">
            <li>èˆé¶´å…¬åœ’ãƒ»ç¦å²¡åŸè·¡ï¼ˆèˆé¶´å…¬åœ’ï¼‰</li>
            <li>è¥¿å…¬åœ’</li>
            <li>æµ·ã®ä¸­é“æµ·æµœå…¬åœ’</li>
            <li>ç™½é‡æ±Ÿæ¤ç‰©å…¬åœ’</li>
            <li>å£ç”Ÿå…¬åœ’</li>
            <li>å°å€‰åŸ</li>
            <li>æµ…äº•ä¸€æœ¬æ¡œï¼ˆèŠ±æœŸå¯èƒ½åæ™šï¼‰</li>
          </ul>
        </div>
      </section>

      <section class="mt-4 space-y-3">
        <div v-for="(day, di) in plan.days" :key="day.id" :id="`day-${di+1}`" class="bg-white rounded-2xl shadow-soft border border-stone-200 overflow-hidden">
          <div class="p-4 border-b border-stone-200">
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <div class="text-xs text-stone-500">{{ day.date }}</div>
                <div class="text-base font-semibold editable" :contenteditable="editMode" @blur="onBlurText($event, `days.${di}.title`)">{{ day.dayLabel }}ï¼š{{ day.title }}</div>
                <div class="mt-1 text-sm text-stone-600 editable" :contenteditable="editMode" @blur="onBlurText($event, `days.${di}.summary`)">{{ day.summary }}</div>
              </div>
              <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="openGoogleMapsDay(day)">Maps</button>
            </div>

            <div class="mt-3 flex flex-wrap gap-2 text-xs">
              <span class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Baseï¼š{{ day.base.name }}</span>
              <span class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Areaï¼š{{ day.area }}</span>
              <span v-if="day.driveHint" class="px-2 py-1 rounded-full bg-stone-100 border border-stone-200">Driveï¼š{{ day.driveHint }}</span>
            </div>
          </div>

          <div class="p-4 space-y-3">
            <div v-for="(stop, si) in day.stops" :key="stop.id" class="rounded-2xl border border-stone-200 bg-stone-50 p-4">
              <div class="flex items-start gap-3">
                <input type="checkbox" class="mt-1 h-5 w-5 accent-stone-700" :checked="isDone(day.id, stop.id)" @change="toggleDone(day.id, stop.id)" />

                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 flex-wrap">
                    <span class="text-xs text-stone-500 tabular-nums" v-if="stop.time">{{ stop.time }}</span>
                    <span class="text-xs px-2 py-1 rounded-full border" :class="levelBadge(stop.level)">{{ levelText(stop.level) }}</span>
                    <span class="text-xs px-2 py-1 rounded-full border" :class="kindBadge(stop.kind)">{{ kindText(stop.kind) }}</span>
                    <span v-if="stop.bestShot" class="text-xs px-2 py-1 rounded-full border border-stone-300 bg-white">æ‹æ”ï¼š{{ stop.bestShot }}</span>
                  </div>

                  <div class="mt-2 text-sm font-semibold editable" :contenteditable="editMode" @blur="onBlurText($event, `days.${di}.stops.${si}.title`)">{{ stop.title }}</div>
                  <div v-if="stop.titleLocal" class="mt-1 text-xs text-stone-600 editable" :contenteditable="editMode" @blur="onBlurText($event, `days.${di}.stops.${si}.titleLocal`)">{{ stop.titleLocal }}</div>

                  <div class="mt-2 text-sm text-stone-700 whitespace-pre-wrap editable" :contenteditable="editMode" @blur="onBlurText($event, `days.${di}.stops.${si}.desc`)">{{ stop.desc }}</div>

                  <div v-if="stop.lens" class="mt-2 text-xs text-stone-600 whitespace-pre-wrap">ğŸ“· {{ stop.lens }}</div>

                  <div class="mt-3 flex flex-wrap gap-2">
                    <a v-if="stop.mapsQuery" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="mapsSearchUrl(stop.mapsQuery)" target="_blank" rel="noreferrer">Google Maps</a>
                    <a v-for="(lk, li) in (stop.links||[])" :key="li" class="tap inline-flex items-center px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="lk.url" target="_blank" rel="noreferrer">{{ lk.label }}</a>
                  </div>

                  <div class="mt-3 text-xs text-stone-600 flex flex-wrap gap-x-4 gap-y-1">
                    <span v-if="stop.stayMins" class="tabular-nums">åœç•™ï¼š{{ stop.stayMins }} min</span>
                    <span v-if="stop.costJPY" class="tabular-nums">è²»ç”¨ï¼šÂ¥{{ Number(stop.costJPY).toLocaleString() }}</span>
                  </div>
                </div>

                <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white shadow-sm text-sm hover:bg-stone-50" @click="openStopMenu(di, si)">â‹¯</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4 bg-white rounded-2xl shadow-soft border border-stone-200 p-4">
        <div class="text-sm font-semibold">å·¥å…·</div>
        <div class="mt-3 flex flex-wrap gap-2">
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="openJson('export')">åŒ¯å‡º JSON</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="openJson('import')">åŒ¯å…¥ JSON</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="copyShare">è¤‡è£½åˆ†äº«é€£çµ</button>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="resetPlan">é‡ç½®ï¼ˆå›åˆ°é è¨­ï¼‰</button>
        </div>
        <div class="mt-2 text-xs text-stone-500">æé†’ï¼šæ­¤æª”æ¡ˆå¯é›¢ç·šä½¿ç”¨ï¼›è‹¥è¦ç·šä¸Šåˆ†äº«ï¼Œå¯æ”¾ GitHub Pages / Netlify / Vercelï¼ˆéœæ…‹ç«™ï¼‰ã€‚</div>
      </section>

      <div class="h-8"></div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 z-40 border-t border-stone-200 bg-stone-50/90 backdrop-blur">
      <div class="max-w-3xl mx-auto px-4 py-2 flex items-center gap-2 overflow-x-auto no-scrollbar">
        <a class="tap shrink-0 px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" href="#weather">å¤©æ°£</a>
        <a v-for="(d, i) in plan.days" :key="d.id" class="tap shrink-0 px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" :href="`#day-${i+1}`">Day {{ i+1 }}</a>
        <button class="tap shrink-0 ml-auto px-3 py-2 rounded-xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="scrollTop">å›é ‚éƒ¨</button>
      </div>
    </nav>

    <!-- JSON modal -->
    <div v-if="modals.json.open" class="fixed inset-0 z-50 flex items-end md:items-center justify-center">
      <div class="absolute inset-0 bg-black/25" @click="closeJson"></div>
      <div class="relative w-full md:max-w-2xl bg-white rounded-t-3xl md:rounded-3xl shadow-soft border border-stone-200 p-4 md:p-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">{{ modals.json.mode==='export' ? 'åŒ¯å‡º JSON' : 'åŒ¯å…¥ JSON' }}</div>
            <div class="text-xs text-stone-500">å¯ç”¨ä¾†æ¬ç§»/å‚™ä»½è¡Œç¨‹è³‡æ–™ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="closeJson">é—œé–‰</button>
        </div>
        <textarea class="mt-3 w-full rounded-2xl border border-stone-300 bg-stone-50 p-3 text-xs font-mono" rows="12" v-model="modals.json.text"></textarea>
        <div class="mt-3 flex gap-2">
          <button v-if="modals.json.mode==='export'" class="tap flex-1 px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="copyText(modals.json.text)">è¤‡è£½</button>
          <button v-else class="tap flex-1 px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="importJson">åŒ¯å…¥ä¸¦è¦†è“‹</button>
        </div>
      </div>
    </div>

    <!-- Stop menu modal -->
    <div v-if="modals.stop.open" class="fixed inset-0 z-50 flex items-end md:items-center justify-center">
      <div class="absolute inset-0 bg-black/25" @click="closeStopMenu"></div>
      <div class="relative w-full md:max-w-lg bg-white rounded-t-3xl md:rounded-3xl shadow-soft border border-stone-200 p-4 md:p-5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-sm font-semibold">é …ç›®è¨­å®š</div>
            <div class="text-xs text-stone-500">èª¿æ•´ç­‰ç´š/é¡å‹èˆ‡å°é‡æ•¸å€¼ã€‚</div>
          </div>
          <button class="tap px-3 py-2 rounded-xl border border-stone-300 bg-white text-sm hover:bg-stone-50" @click="closeStopMenu">é—œé–‰</button>
        </div>

        <div class="mt-4 grid grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-stone-600">ç­‰ç´š</label>
            <select class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.level">
              <option value="must">å¿…å»</option>
              <option value="flex">å¯èª¿æ•´</option>
              <option value="backup">å‚™æ¡ˆ</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-stone-600">é¡å‹</label>
            <select class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.kind">
              <option value="spot">æ™¯é»</option>
              <option value="hotel">ä½å®¿</option>
              <option value="drive">è‡ªé§•/ç§»å‹•</option>
              <option value="task">ä»»å‹™</option>
            </select>
          </div>
          <div>
            <label class="text-xs text-stone-600">åœç•™ï¼ˆminï¼‰</label>
            <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.stayMins" placeholder="60" />
          </div>
          <div>
            <label class="text-xs text-stone-600">è²»ç”¨ï¼ˆJPYï¼‰</label>
            <input class="tap w-full rounded-xl border border-stone-300 bg-stone-50 px-3 py-2 text-sm" v-model="stopMenu.costJPY" placeholder="800" />
          </div>
        </div>

        <button class="tap mt-4 w-full px-3 py-3 rounded-2xl bg-stone-800 text-stone-50 text-sm hover:bg-stone-700" @click="applyStopMenu">å„²å­˜</button>
      </div>
    </div>

  </div>

  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;

    const EXCHANGE_RATE = 4.6;
    const LS_KEY = 'kyushu_sakura_2026_plan_v1';
    const LS_DONE_KEY = 'kyushu_sakura_2026_done_v1';

    const defaultPlan = {
      meta: {
        tripCode: 'KYUSHU-SAKURA-2026',
        title: '2026 ä¹å·è³æ«»è‡ªé§•ï½œDr. Huang & å¤ªå¤ª',
        dateRange: '2026/03/25 (ä¸‰) - 2026/03/28 (å…­) Â· 4å¤©3å¤œ',
        party: '2 äººï¼ˆç„¡é•·è¼©/å°å­©ï¼‰',
        mobility: 'å»ç¨‹ï¼šæŠµé” FUK 11:15ï½œç§Ÿè»Šï¼šãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ï¼ˆTabiraiï¼‰3/25 13:00 ç¦å²¡ç©ºæ¸¯ï¼ˆå›½å†…ç·šï¼‰å–è»Š â†’ 3/27 18:00 åšå¤šé§… åšå¤šå£ é‚„è»Šï½œETC å¡ + NOC å…è²¬',
        gear: 'Sony A7CRï¼š35mm / 24-70mmï½œFUJIFILM X-T5ï¼š16-300mm',
        notes: `ä½å®¿ï¼š\n- 3/25â€“3/27ï¼ˆé€£æ³Š 2 æ™šï¼‰ï¼šæ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ï¼ˆKAI Asoï¼‰\n- 3/27ï¼šä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’ï¼ˆå¤§æµ´å ´ï¼‰\n\nèŠ±æ³æŸ¥è©¢ï¼š\n- ã‚¦ã‚§ã‚¶ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ æ¡œï¼šhttps://weathernews.jp/sakura/\n- tenki.jp æ¡œï¼šhttps://tenki.jp/sakura/\n\nè‡ªé§•ï¼šETC å¡ / NOC å…è²¬å·²å«ã€‚å±±è·¯è«‹ä¿ç•™ 15â€“25% ç·©è¡ã€‚\n\nå›ç¨‹èˆªç­ï¼ˆå·²è¨‚ï¼‰ï¼š\n- BR101 FUKâ†’TPE 20:55â†’22:40ï¼ˆ2026/03/28ï¼‰` 
      },
      tasks: [
        {
          id: 'task-sakura-check',
          title: 'èŠ±æ³ç¢ºèªï¼šå—é˜¿è˜‡ï¼ˆä¸€æœ¬æ«»ï¼‰èˆ‡ç¦å²¡å¸‚å€',
          note: `å‡ºç™¼å‰ 7 å¤©èµ·æ¯å¤©çœ‹ä¸€æ¬¡ï¼š\n- ã‚¦ã‚§ã‚¶ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ æ¡œ / tenki.jp æ¡œ\n\né‡é»ï¼š\n- ä¸€å¿ƒè¡Œã®å¤§æ¡œï¼ˆå—é˜¿è˜‡ï¼‰\n- è¦³éŸ³æ¡œï¼ˆå—é˜¿è˜‡ï¼‰\n- é«˜æ£®åƒæœ¬æ¡œï¼ˆé«˜æ£®ï¼‰\n- ç¦å²¡ï¼šèˆé¶´å…¬åœ’ / è¥¿å…¬åœ’ï¼ˆå‚™æ¡ˆï¼‰`
        },
        {
          id: 'task-takachiho-boat',
          title: 'é«˜åƒç©‚å³¡ è²¸ã—ãƒœãƒ¼ãƒˆï¼šæ¶é ç´„ï¼ˆæˆ–æ”¹èµ°æ­¥é“ï¼‰',
          note: `è¦å‰‡ï¼šä¹˜èˆ¹æ—¥ 2 é€±å‰ 09:00ï¼ˆJSTï¼‰èµ·å¯ç·šä¸Šé ç´„ï¼ˆä¾å®˜æ–¹ç‚ºæº–ï¼‰ã€‚\nå‚™æ¡ˆï¼šè‹¥æ²’æ¶åˆ°èˆ¹ â†’ èµ°æ­¥é“çœ‹ã€ŒçœŸåäº•ã®æ»ã€ï¼‹æ‹ç…§ã€‚\né ç´„ï¼šé«˜åƒç©‚ç”ºè¦³å…‰å”ä¼šï¼ˆè²¸ã—ãƒœãƒ¼ãƒˆäºˆç´„ã‚µã‚¤ãƒˆï¼‰\næé†’ï¼šææ—©æŠµé”ç¬¬1å¾¡å¡©äº•é§è»Šå ´ï¼Œç†±é–€æ™‚æ®µå¾ˆå¿«æ»¿ã€‚`
        },
        {
          id: 'task-aso-crater',
          title: 'é˜¿è˜‡ï¼šä¸­å²³ç«å£é–‹æ”¾ç‹€æ³ï¼ˆç•¶å¤©æ—©ä¸Šç¢ºèªï¼‰',
          note: `ä¾é¢¨å‘/æ°£é«”æ¿ƒåº¦å¯èƒ½å°é–‰ã€‚\nè‹¥å°é–‰ï¼šæ”¹è‰åƒé‡Œï¼å‘¨é‚Šå±•æœ›é»å³å¯ï¼Œåˆ¥ç¡¬è¡ã€‚`
        }
      ],
      days: [
        {
          id: 'day1',
          dayLabel: 'Day 1',
          date: '2026/03/25ï¼ˆä¸‰ï¼‰',
          area: 'ç¦å²¡ (Fukuoka) â†’ é˜¿è˜‡ (Aso)',
          title: 'è½åœ°å³ä¸Šå±± Â· ç•Œé˜¿è˜‡å…¥ä½',
          summary: 'æŠŠç¦å²¡å¸‚å€ç•™åˆ°å›ç¨‹ï¼›Day1 ç›´æ¥é€²é˜¿è˜‡ï¼Œç¢ºä¿ç•Œé˜¿è˜‡çš„æ³¡æ¹¯èˆ‡æ—©ç¡ã€‚',
          driveHint: 'FUKâ†’ç•Œ é˜¿è˜‡ï¼ˆé•·è·é›¢ï¼Œå«ä¼‘æ¯ç«™ç·©è¡ï¼‰',
          base: { name: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', lat: 33.08069, lon: 131.193505 },
          stops: [
            { id: 'd1-arrival', time: '11:15', kind: 'drive', level: 'must', title: 'æŠµé”ï¼šç¦å²¡æ©Ÿå ´ (FUK)', titleLocal: 'ç¦å²¡ç©ºæ¸¯ (Fukuoka Airport)', desc: 'å…¥å¢ƒ/å–è¡Œæå¾Œï¼Œå‰å¾€ç§Ÿè»Šæ«ƒå°ï¼ˆåœ‹å…§ç·šï¼‰ã€‚', mapsQuery: 'ç¦å²¡ç©ºæ¸¯ å›½å†…ç·š ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼', stayMins: 60, costJPY: 0 },
            { id: 'd1-car', time: '13:00', kind: 'drive', level: 'must', title: 'å–è»Šï¼šãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç¦å²¡ç©ºæ¸¯ï¼ˆå›½å†…ç·šï¼‰', titleLocal: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç¦å²¡ç©ºæ¸¯', desc: `é ç´„ç•ªå·ï¼š140768698ï¼ˆTabiraiï¼‰\nç¢ºèªï¼šETC å¡ã€NOC å…è²¬ã€è»Šæ³æ‹ç…§ã€‚`, mapsQuery: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ ç¦å²¡ç©ºæ¸¯ å›½å†…ç·š', stayMins: 45, costJPY: 0 },
            { id: 'd1-drive', time: '13:45', kind: 'drive', level: 'must', title: 'ç§»å‹•ï¼šç¦å²¡ â†’ ç•Œ é˜¿è˜‡ï¼ˆå«ä¼‘æ¯ç«™ï¼‰', desc: 'å»ºè­°é€”ä¸­è‡³å°‘åœ 1 æ¬¡ä¼‘æ¯ç«™ã€‚ç­–ç•¥ï¼šä¸ç¡¬å¡æ™¯é»ï¼Œç¢ºä¿å¤©é»‘å‰æŠµé”ã€‚', mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', stayMins: 210, costJPY: 0 },
            { id: 'd1-kai', time: '17:00', kind: 'hotel', level: 'must', title: 'å…¥ä½ï¼šæ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', titleLocal: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', desc: 'Day1 è¡Œç¨‹æ ¸å¿ƒï¼šæˆ¿å…§éœ²å¤©é¢¨å‘‚ã€åœ’å€æ•£æ­¥ã€æ—©ç¡ã€‚', bestShot: 'æ˜/å¤œ', lens: 'å®¤å…§ï¼š35mmï¼›åº­åœ’å±¤æ¬¡ï¼š50â€“70mmã€‚', mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', links: [ { label: 'å®˜æ–¹', url: 'https://hoshinoresorts.com/ja/hotels/kaiaso/' }, { label: 'äº¤é€š', url: 'https://hoshinoresorts.com/ja/hotels/kaiaso/access/' } ], stayMins: 60, costJPY: 0 }
          ]
        },
        {
          id: 'day2',
          dayLabel: 'Day 2',
          date: '2026/03/26ï¼ˆå››ï¼‰',
          area: 'å—é˜¿è˜‡ (Minami Aso) Â· ç«å±±èˆ‡ä¸€æœ¬æ«»',
          title: 'ç«å±±åœ°æ™¯ Â· å—é˜¿è˜‡ä¸‰å¤§æ«»',
          summary: 'ä»¥è‡ªç„¶æ™¯ï¼‹æ«»èŠ±ç‚ºä¸»ï¼šè‰åƒé‡Œ/ç«å£ï¼ˆè¦–å°é–‰ï¼‰ï¼‹ä¸€æœ¬æ«»ç·šï¼Œå‚æ™šå›ç•Œé˜¿è˜‡æ³¡æ¹¯ã€‚',
          driveHint: 'ç•Œ é˜¿è˜‡ â†” å—é˜¿è˜‡ï¼ˆå±±è·¯ï¼Œä¿ç•™ç·©è¡ï¼‰',
          base: { name: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡ (KAI Aso)', lat: 33.08069, lon: 131.193505 },
          stops: [
            { id: 'd2-kusasenri', time: '08:30', kind: 'spot', level: 'must', title: 'è‰åƒé‡Œãƒ¶æµœ (Kusasenri-ga-hama)', titleLocal: 'è‰åƒé‡Œãƒ¶æµœ', desc: 'ä½é£½å’Œåº¦çš„ç«å±±åœ°æ™¯ä¸»å ´ã€‚é¢¨å¤§æ™‚æ³¨æ„ç°å¡µèˆ‡é¡é ­ä¿è­·ã€‚', bestShot: 'æ™¨', lens: '24mm æ‹ä¸­å²³ï¼‹è‰åŸï¼›70mm å£“ç¸®åœ°å½¢èˆ‡é¦¬åŒ¹ã€‚', mapsQuery: 'è‰åƒé‡Œãƒ¶æµœ', stayMins: 60, costJPY: 0 },
            { id: 'd2-nakadake', time: '10:00', kind: 'spot', level: 'flex', title: 'ä¸­å²³ç«å£ï¼ˆNakadake Craterï¼‰', titleLocal: 'é˜¿è˜‡ ä¸­å²³ç«å£', desc: 'è¦–ç•¶æ—¥ç«å±±ç®¡åˆ¶èˆ‡é¢¨å‘é–‹æ”¾ç‹€æ³æ±ºå®šæ˜¯å¦é€²å…¥ï¼›è‹¥å°é–‰å°±æ”¹å‘¨é‚Šå±•æœ›é»ã€‚', bestShot: 'åˆå‰', lens: '24â€“35mm æ‹åœ°å½¢ï¼›70mm æ‹‰è¿‘ç«å£ç…™éœ§å±¤æ¬¡ã€‚', mapsQuery: 'é˜¿è˜‡ ä¸­å²³ç«å£', stayMins: 60, costJPY: 0 },
            { id: 'd2-isshingyo', time: '13:30', kind: 'spot', level: 'must', title: 'ä¸€å¿ƒè¡Œã®å¤§æ¡œ (Isshingyo no Oozakura)', titleLocal: 'ä¸€å¿ƒè¡Œã®å¤§æ¡œ', desc: 'ä¸€æœ¬æ«»ä»£è¡¨ä½œã€‚è‹¥åŒæ™‚æœ‰æ²¹èœèŠ±ï¼Œç•«é¢å°æ¯”å¼·ã€‚', bestShot: 'åˆå', lens: '24â€“70mmï¼šå¤§æ¨¹ï¼‹æ²¹èœèŠ±ï¼›é•·ç„¦å£“ç¸®é˜¿è˜‡å±±ä½œèƒŒæ™¯ã€‚', mapsQuery: 'ä¸€å¿ƒè¡Œã®å¤§æ¡œ', stayMins: 60, costJPY: 0 },
            { id: 'd2-kannon', time: '14:45', kind: 'spot', level: 'flex', title: 'è¦³éŸ³æ¡œï¼ˆKannon Sakuraï¼‰', titleLocal: 'è¦³éŸ³æ¡œ', desc: 'å±•æœ›å‹ä¸€æœ¬æ«»ï¼šä¿¯ç°å—é˜¿è˜‡ç ´ç«å±±å£åœ°å½¢ã€‚', bestShot: 'åˆå', lens: 'å»£è§’å¿…å¸¶ï¼›é•·ç„¦å£“ç¸®è¾²ç”°æ£‹ç›¤ç´‹ç†ã€‚', mapsQuery: 'è¦³éŸ³æ¡œ å—é˜¿è˜‡', stayMins: 45, costJPY: 0 },
            { id: 'd2-shirakawa', time: '15:45', kind: 'spot', level: 'flex', title: 'ç™½å·æ°´æº (Shirakawa Suigen)', titleLocal: 'ç™½å·æ°´æº', desc: 'è£æ°´é»ã€‚äººå¤šæ™‚çŸ­åœç•™å³å¯ã€‚', bestShot: 'åˆå', lens: '24â€“35mm æ‹æ°´é¢ç´‹ç†ï¼›æ³¨æ„åå…‰ã€‚', mapsQuery: 'ç™½å·æ°´æº', stayMins: 30, costJPY: 0 },
            { id: 'd2-back', time: '17:00', kind: 'hotel', level: 'must', title: 'å›åˆ°ç•Œ é˜¿è˜‡ï¼šæ³¡æ¹¯ï¼‹æ™šé¤', desc: 'åˆå¾Œæ”¶å°¾å›å®¿ï¼Œç•™æ™‚é–“çµ¦æˆ¿å…§éœ²å¤©é¢¨å‘‚ã€‚', bestShot: 'å¤œ', lens: 'å®¤å…§éš¨æ‹ 35mm å³å¯ã€‚', mapsQuery: 'æ˜Ÿé‡ãƒªã‚¾ãƒ¼ãƒˆ ç•Œ é˜¿è˜‡', stayMins: 120, costJPY: 0 }
          ]
        },
        {
          id: 'day3',
          dayLabel: 'Day 3',
          date: '2026/03/27ï¼ˆäº”ï¼‰',
          area: 'é˜¿è˜‡ â†’ é«˜åƒç©— (Takachiho) â†’ ç¦å²¡ (Hakata/Gion)',
          title: 'é«˜åƒç©—å³½ Â· å›ç¦å²¡é€›è¡—ï¼‹å¤§æµ´å ´',
          summary: 'ä¸Šåˆé«˜åƒç©—å³½ï¼ˆèˆ¹éœ€é ç´„ï¼›æ¶ä¸åˆ°å°±èµ°æ­¥é“ï¼‰ï¼Œåˆå¾Œè¶•å›åšå¤š 18:00 é‚„è»Šï¼Œæ™šä¸Šç•™çµ¦å¤ªå¤ªé€›è¡—ã€‚',
          driveHint: 'ç•Œ é˜¿è˜‡â†’é«˜åƒç©—â†’åšå¤šï¼ˆ18:00 é‚„è»Šå›ºå®šï¼‰',
          base: { name: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’', lat: 33.5917, lon: 130.4146 },
          stops: [
            { id: 'd3-takamori', time: '08:30', kind: 'spot', level: 'backup', title: 'é«˜æ£®åƒæœ¬æ¡œï¼ˆTakamori Senbonzakuraï¼‰', titleLocal: 'é«˜æ£®åƒæœ¬æ¡œ', desc: 'è‹¥ Day2 æ²’å»ã€ä¸”èŠ±æ³æ­£å¥½æ‰é †è·¯çŸ­åœï¼›å¦å‰‡ç›´æ¥å‰å¾€é«˜åƒç©—ã€‚', bestShot: 'åˆå‰', lens: 'é•·ç„¦å£“ç¸®å½é“èˆ‡æ¨¹æµ·ï¼›35mm åšé“è·¯å¼•å°ç·šã€‚', mapsQuery: 'é«˜æ£®åƒæœ¬æ¡œ', stayMins: 30, costJPY: 0 },
            { id: 'd3-takachiho-boat', time: '10:30', kind: 'spot', level: 'must', title: 'é«˜åƒç©‚å³¡ï¼šè²¸ã—ãƒœãƒ¼ãƒˆï¼æ•£ç­–', titleLocal: 'é«˜åƒç©‚å³¡ï¼ˆè²¸ã—ãƒœãƒ¼ãƒˆï¼‰', desc: 'è‡ªç„¶æ™¯é‡é»ã€‚è‹¥æ¶åˆ°èˆ¹å°±åˆ’èˆ¹ï¼›è‹¥æ²’æ¶åˆ°å°±èµ°æ­¥é“çœ‹ã€ŒçœŸåäº•ã®æ»ã€èˆ‡å³½è°·å‚ç›´å²©å£ã€‚', bestShot: 'åˆå‰/åˆå', lens: '24â€“35mm æ‹å³½è°·ç·šæ¢ï¼›70â€“300mm æ‹‰è¿‘ç€‘å¸ƒèˆ‡åˆ’èˆ¹ç•«é¢ã€‚èˆ¹ä¸Šæ³¨æ„é˜²æ°´/æ‰‹æ©Ÿç¹©ã€‚', mapsQuery: 'é«˜åƒç©‚å³¡ ç¬¬1å¾¡å¡©äº•é§è»Šå ´', links: [ { label: 'è²¸ã—ãƒœãƒ¼ãƒˆäºˆç´„', url: 'https://eipro.jp/takachiho1/eventCalendars/index' } ], stayMins: 150, costJPY: 5200 },
            { id: 'd3-drive', time: '13:30', kind: 'drive', level: 'must', title: 'ç§»å‹•ï¼šé«˜åƒç©— â†’ åšå¤šï¼ˆå«ä¼‘æ¯ç«™ï¼‰', desc: 'ä»¥ 18:00 é‚„è»Šç‚ºç¡¬ç›®æ¨™ï¼šè·¯ä¸Šå¡è»Šå°±ç¸®çŸ­åˆé¤/è³¼ç‰©ï¼ŒæŠŠç·©è¡ç•™çµ¦å›ç¨‹ã€‚', mapsQuery: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§… åšå¤šå£', stayMins: 270, costJPY: 0 },
            { id: 'd3-return', time: '18:00', kind: 'drive', level: 'must', title: 'é‚„è»Šï¼šãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§… åšå¤šå£', titleLocal: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§…', desc: 'é‚„è»Šå‰åŠ æ²¹ã€æ‹ç…§çµæ¡ˆã€‚åœ°å€ï¼šåšå¤šé§…å‰1-15-20 NMFåšå¤šé§…å‰ãƒ“ãƒ«1F', mapsQuery: 'ãƒˆãƒ¨ã‚¿ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ åšå¤šé§… åšå¤šå£', stayMins: 30, costJPY: 0 },
            { id: 'd3-hotel', time: '19:00', kind: 'hotel', level: 'must', title: 'å…¥ä½ï¼šä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’ï¼ˆå¤§æµ´å ´ï¼‰', titleLocal: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’', desc: 'é‚„è»Šå¾Œæ­¥è¡Œ/è¨ˆç¨‹è»Šåˆ°é£¯åº—ï¼Œå…ˆæ³¡å¤§æµ´å ´å†å‡ºé–€ã€‚', bestShot: 'å¤œ', lens: 'é£¯åº—/è¡—æ‹ï¼š35mmã€‚', mapsQuery: 'ä¸‰äº•ã‚¬ãƒ¼ãƒ‡ãƒ³ãƒ›ãƒ†ãƒ«ç¦å²¡ç¥‡åœ’', stayMins: 45, costJPY: 0 },
            { id: 'd3-shop', time: '20:30', kind: 'spot', level: 'flex', title: 'é€›è¡—ï¼šã‚­ãƒ£ãƒŠãƒ«ã‚·ãƒ†ã‚£åšå¤š / å¤©ç¥åœ°ä¸‹è¡—', titleLocal: 'ã‚­ãƒ£ãƒŠãƒ«ã‚·ãƒ†ã‚£åšå¤š', desc: 'çµ¦å¤ªå¤ªçš„é€›è¡—çª—å£ï¼Œé‡é»æ˜¯ä¸è¶•ã€‚', bestShot: 'å¤œ', lens: '35mm èµ°æ‹ï¼›24â€“35mm æ‹å»ºç¯‰ç·šæ¢ã€‚', mapsQuery: 'ã‚­ãƒ£ãƒŠãƒ«ã‚·ãƒ†ã‚£åšå¤š', stayMins: 90, costJPY: 3000 }
          ]
        },
        {
          id: 'day4',
          dayLabel: 'Day 4',
          date: '2026/03/28ï¼ˆå…­ï¼‰',
          area: 'ç¦å²¡å¸‚å€ Â· å¤ªå®°åºœ â†’ FUK',
          title: 'å¤ªå®°åºœ Â· å¸‚å€è£œè²¨ Â· æ™šç­å›å°',
          summary: 'ä¸Šåˆå¤ªå®°åºœï¼ˆå¿…å»ï¼‰ï¼Œä¸‹åˆå¸‚å€è£œè²¨ï¼›BR101 20:55 å›å°ã€‚',
          driveHint: 'å¸‚å€ç§»å‹•ï¼ˆåœ°éµ/è¥¿éµï¼‰',
          base: { name: 'ç¦å²¡å¸‚å€ï¼ˆHakata/Gionï¼‰', lat: 33.5917, lon: 130.4146 },
          stops: [
            { id: 'd4-dazaifu', time: '09:30', kind: 'spot', level: 'must', title: 'å¤ªå®°åºœå¤©æº€å®® (Dazaifu Tenmangu)', titleLocal: 'å¤ªå®°åºœå¤©æº€å®®', desc: 'å¿…å»é»ã€‚è‹¥æƒ³é¿äººæ½®å»ºè­°æ—©åˆ°ï¼Œå¯é †æ‰‹åƒæ¢…ãƒ¶æé¤…ã€‚', bestShot: 'æ™¨', lens: '35mm è¨˜éŒ„ï¼›24mm æ‹åƒé“èˆ‡å»ºç¯‰ç·šæ¢ã€‚', mapsQuery: 'å¤ªå®°åºœå¤©æº€å®®', stayMins: 120, costJPY: 0 },
            { id: 'd4-lalaport', time: '13:00', kind: 'spot', level: 'flex', title: 'è³¼ç‰©ï¼šã‚‰ã‚‰ã½ãƒ¼ã¨ç¦å²¡ / å¤©ç¥', titleLocal: 'ã‚‰ã‚‰ã½ãƒ¼ã¨ç¦å²¡', desc: 'è³¼ç‰©/é€€ç¨…/ä¼´æ‰‹ç¦®ã€‚è‹¥ä¸æƒ³è·‘é ï¼Œå°±å›å¤©ç¥/åšå¤šç«™å‘¨é‚Šå³å¯ã€‚', lens: 'å®¤å…§ä¸å¿…å¤šé¡ã€‚', mapsQuery: 'ã‚‰ã‚‰ã½ãƒ¼ã¨ç¦å²¡', stayMins: 150, costJPY: 0 },
            { id: 'd4-flight', time: '20:55', kind: 'drive', level: 'must', title: 'å›ç¨‹ï¼šç¦å²¡ (FUK) â†’ å°åŒ— (TPE)', titleLocal: 'BR101', desc: 'BR101 20:55 â†’ 22:40ï¼ˆT2ï¼‰ã€‚å»ºè­°è‡³å°‘ 2 å°æ™‚å‰åˆ°æ©Ÿå ´ã€‚', mapsQuery: 'Fukuoka Airport', stayMins: 0, costJPY: 0 }
          ]
        }
      ]
    };

    function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }

    function b64UrlEncode(str){
      const b64 = btoa(unescape(encodeURIComponent(str)));
      return b64.replaceAll('+','-').replaceAll('/','_').replaceAll('=','');
    }
    function b64UrlDecode(b64url){
      let b64 = b64url.replaceAll('-','+').replaceAll('_','/');
      while(b64.length % 4) b64 += '=';
      return decodeURIComponent(escape(atob(b64)));
    }

    createApp({
      data(){
        return {
          editMode: false,
          plan: deepClone(defaultPlan),
          doneMap: {},
          weatherDayIndex: 0,
          weather: { loading: false, error: '', items: [] },
          modals: { json: { open: false, mode: 'export', text: '' }, stop: { open: false, di: -1, si: -1 } },
          stopMenu: { level: 'must', kind: 'spot', stayMins: '', costJPY: '' },
        }
      },
      computed: {
        totalStops(){
          const dayStops = this.plan.days.reduce((acc,d)=>acc + (d.stops?.length||0), 0);
          const taskStops = (this.plan.tasks?.length||0);
          return dayStops + taskStops;
        },
        doneCount(){ return Object.values(this.doneMap).filter(Boolean).length; },
        progressPct(){ return this.totalStops ? Math.round((this.doneCount / this.totalStops) * 100) : 0; },
        totalJPY(){
          let sum = 0;
          for(const d of this.plan.days){ for(const s of (d.stops||[])) sum += Number(s.costJPY||0); }
          return Math.round(sum);
        },
        totalTWD(){ return Math.round(this.totalJPY * EXCHANGE_RATE); }
      },
      mounted(){
        this.loadFromHashOrLocal();
        this.migratePlan();
        this.loadDone();
        this.fetchWeather();
        window.addEventListener('hashchange', () => { this.loadFromHashOrLocal(); this.migratePlan(); });
      },
      methods: {
        kindText(kind){ return ({ spot:'æ™¯é»', hotel:'ä½å®¿', drive:'ç§»å‹•', task:'ä»»å‹™' }[kind]) || kind; },
        levelText(level){ return ({ must:'å¿…å»', flex:'å¯èª¿æ•´', backup:'å‚™æ¡ˆ' }[level]) || level; },
        kindBadge(){ return 'border-stone-300 bg-white text-stone-700'; },
        levelBadge(level){
          return ({
            must:'border-stone-700 bg-stone-800 text-stone-50',
            flex:'border-stone-300 bg-white text-stone-700',
            backup:'border-stone-300 bg-stone-100 text-stone-700'
          }[level]) || 'border-stone-300 bg-white text-stone-700';
        },

        toggleEdit(){ this.editMode = !this.editMode; },
        onBlurText(evt, path){
          if(!this.editMode) return;
          const value = (evt.target.innerText ?? '').trimEnd();
          this.setByPath(path, value);
          this.persist();
        },
        setByPath(path, value){
          const segs = path.split('.');
          let cur = this.plan;
          for(let i=0;i<segs.length-1;i++){
            const k = segs[i];
            cur = cur?.[k];
            if(cur === undefined || cur === null) return;
          }
          cur[segs[segs.length-1]] = value;
        },

        doneKey(dayId, stopId){ return `${dayId}::${stopId}`; },
        loadDone(){
          try{ this.doneMap = JSON.parse(localStorage.getItem(LS_DONE_KEY) || '{}'); }
          catch(_){ this.doneMap = {}; }
        },
        saveDone(){ try{ localStorage.setItem(LS_DONE_KEY, JSON.stringify(this.doneMap)); }catch(_){ } },
        isDone(dayId, stopId){ return !!this.doneMap[this.doneKey(dayId, stopId)]; },
        toggleDone(dayId, stopId){ const k = this.doneKey(dayId, stopId); this.doneMap[k] = !this.doneMap[k]; this.saveDone(); },
        resetDone(){ this.doneMap = {}; this.saveDone(); },

        weatherCodeToText(code){
          if(code === 0) return 'æ™´';
          if([1,2,3].includes(code)) return 'å¤šé›²';
          if([45,48].includes(code)) return 'éœ§';
          if([51,53,55,56,57].includes(code)) return 'æ¯›æ¯›é›¨';
          if([61,63,65,66,67].includes(code)) return 'é›¨';
          if([71,73,75,77].includes(code)) return 'é›ª';
          if([80,81,82].includes(code)) return 'é™£é›¨';
          if([95,96,99].includes(code)) return 'é›·é›¨';
          return 'ä¸æ˜';
        },
        async fetchWeather(){
          const d = this.plan.days[this.weatherDayIndex] || this.plan.days[0];
          if(!d?.base?.lat || !d?.base?.lon) return;
          this.weather.loading = true;
          this.weather.error = '';
          try{
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${encodeURIComponent(d.base.lat)}&longitude=${encodeURIComponent(d.base.lon)}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=Asia%2FTokyo`;
            const res = await fetch(url);
            if(!res.ok) throw new Error('weather fetch failed');
            const json = await res.json();
            const dates = json.daily?.time || [];
            const code = json.daily?.weathercode || [];
            const tmax = json.daily?.temperature_2m_max || [];
            const tmin = json.daily?.temperature_2m_min || [];
            const p = json.daily?.precipitation_sum || [];
            this.weather.items = dates.slice(0,5).map((dt, i) => ({
              date: dt,
              text: this.weatherCodeToText(code[i]),
              tmax: Math.round(tmax[i] ?? 0),
              tmin: Math.round(tmin[i] ?? 0),
              precip: Math.round((p[i] ?? 0) * 10) / 10,
            }));
          }catch(_){
            this.weather.error = 'å¤©æ°£è®€å–å¤±æ•—ï¼ˆå¯èƒ½æ˜¯ç¶²è·¯/é˜»æ“‹è·¨åŸŸï¼‰ã€‚';
          }finally{
            this.weather.loading = false;
          }
        },

        mapsSearchUrl(q){ return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`; },
        openGoogleMapsDay(day){
          const points = [];
          if(day.base?.name) points.push(day.base.name);
          for(const s of (day.stops||[])) if(s.mapsQuery) points.push(s.mapsQuery);
          if(points.length < 2){ window.open(this.mapsSearchUrl(day.base?.name || day.area), '_blank', 'noreferrer'); return; }
          const origin = points[0];
          const destination = points[points.length-1];
          const waypoints = points.slice(1, -1).join('|');
          const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}&travelmode=driving&waypoints=${encodeURIComponent(waypoints)}`;
          window.open(url, '_blank', 'noreferrer');
        },

        openStopMenu(di, si){
          const stop = this.plan.days[di].stops[si];
          this.modals.stop = { open:true, di, si };
          this.stopMenu = {
            level: stop.level || 'must',
            kind: stop.kind || 'spot',
            stayMins: stop.stayMins ? String(stop.stayMins) : '',
            costJPY: stop.costJPY ? String(stop.costJPY) : ''
          };
        },
        closeStopMenu(){ this.modals.stop.open = false; },
        applyStopMenu(){
          const { di, si } = this.modals.stop;
          const stop = this.plan.days[di].stops[si];
          stop.level = this.stopMenu.level;
          stop.kind = this.stopMenu.kind;
          stop.stayMins = this.stopMenu.stayMins ? Number(this.stopMenu.stayMins) : 0;
          stop.costJPY = this.stopMenu.costJPY ? Number(this.stopMenu.costJPY) : 0;
          this.persist();
          this.closeStopMenu();
        },

        openJson(mode){
          this.modals.json.open = true;
          this.modals.json.mode = mode;
          this.modals.json.text = mode === 'export' ? JSON.stringify(this.plan, null, 2) : '';
        },
        closeJson(){ this.modals.json.open = false; },
        importJson(){
          try{
            this.plan = JSON.parse(this.modals.json.text);
            this.persist();
            this.weatherDayIndex = 0;
            this.fetchWeather();
            this.closeJson();
          }catch(_){
            alert('JSON æ ¼å¼éŒ¯èª¤');
          }
        },

        async copyText(text){
          try{ await navigator.clipboard.writeText(text); alert('å·²è¤‡è£½'); }
          catch(_){ alert('è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰ã€‚'); }
        },

        setHashFromPlan(){
          try{ const enc = b64UrlEncode(JSON.stringify(this.plan)); location.hash = `#p=${enc}`; }
          catch(_){ }
        },
        copyShare(){ this.setHashFromPlan(); this.copyText(location.href); },

        migratePlan(){
          // åªåšã€Œè£œé½Šã€ï¼šä¸è¦†è“‹ä½ æ‰‹å‹•æ”¹éçš„å…§å®¹
          let changed = false;

          // days
          if(!Array.isArray(this.plan.days)){
            this.plan.days = deepClone(defaultPlan.days);
            changed = true;
          }

          // tasks
          if(!Array.isArray(this.plan.tasks)){
            this.plan.tasks = [];
            changed = true;
          }
          for(const t of defaultPlan.tasks){
            if(t?.id && !this.plan.tasks.some(x => x.id === t.id)){
              this.plan.tasks.push(deepClone(t));
              changed = true;
            }
          }

          // ensure day3 exists
          const tplDay3 = defaultPlan.days.find(d => d.id === 'day3');
          let day3 = (this.plan.days || []).find(d => d.id === 'day3');
          if(!day3 && tplDay3){
            // æ’åœ¨ day2 å¾Œé¢ï¼ˆè‹¥èƒ½æ‰¾åˆ°ï¼‰
            const idx2 = this.plan.days.findIndex(d => d.id === 'day2');
            const insertAt = idx2 >= 0 ? idx2 + 1 : this.plan.days.length;
            this.plan.days.splice(insertAt, 0, deepClone(tplDay3));
            day3 = (this.plan.days || []).find(d => d.id === 'day3');
            changed = true;
          }

          // day3 stop: Takachiho
          if(day3 && tplDay3){
            if(!Array.isArray(day3.stops)){
              day3.stops = [];
              changed = true;
            }
            const st = tplDay3.stops.find(s => s.id === 'd3-takachiho-boat');
            if(st && !day3.stops.some(s => s.id === st.id)){
              const idxDrive = day3.stops.findIndex(s => s.id === 'd3-drive');
              const insertAt = idxDrive > 0 ? idxDrive : 0;
              day3.stops.splice(insertAt, 0, deepClone(st));
              changed = true;
            }
          }

          if(changed) this.persist();
        },

        persist(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(this.plan)); }catch(_){ } },
        loadFromHashOrLocal(){
          const h = location.hash || '';
          const m = h.match(/#p=([^&]+)/);
          if(m && m[1]){
            try{ this.plan = JSON.parse(b64UrlDecode(m[1])); this.persist(); return; }
            catch(_){ }
          }
          try{
            const raw = localStorage.getItem(LS_KEY);
            this.plan = raw ? JSON.parse(raw) : deepClone(defaultPlan);
          }catch(_){
            this.plan = deepClone(defaultPlan);
          }
        },
        resetPlan(){
          if(!confirm('ç¢ºå®šè¦é‡ç½®ç‚ºé è¨­è¡Œç¨‹ï¼Ÿï¼ˆæœƒè¦†è“‹ç›®å‰ä¿®æ”¹ï¼‰')) return;
          this.plan = deepClone(defaultPlan);
          this.persist();
          this.weatherDayIndex = 0;
          this.fetchWeather();
          history.replaceState(null, '', location.pathname + location.search);
        },

        addTask(){ this.plan.tasks.push({ id: `task-${Date.now()}`, title: 'æ–°ä»»å‹™', note: 'ï¼ˆé»ç·¨è¼¯å¾Œå¯ä¿®æ”¹ï¼‰' }); this.persist(); },
        deleteTask(i){
          if(!confirm('åˆªé™¤æ­¤ä»»å‹™ï¼Ÿ')) return;
          const t = this.plan.tasks[i];
          delete this.doneMap[this.doneKey('task', t.id)];
          this.plan.tasks.splice(i,1);
          this.persist();
          this.saveDone();
        },

        scrollTop(){ window.scrollTo({ top: 0, behavior: 'smooth' }); }
      }
    }).mount('#app');

    (function runSmokeTests(){
      try {
        console.assert(b64UrlDecode(b64UrlEncode('hello')) === 'hello', 'b64Url encode/decode');
        console.assert(Array.isArray(defaultPlan.days) && defaultPlan.days.length === 4, 'days length should be 4');
        console.assert(Array.isArray(defaultPlan.tasks) && defaultPlan.tasks.length >= 2, 'tasks should have >= 2');
        console.assert(defaultPlan.tasks.some(t => t.id === 'task-takachiho-boat'), 'Takachiho booking task should exist');
        const d3 = defaultPlan.days.find(d => d.id === 'day3');
        console.assert(!!d3 && d3.stops.some(s => s.id === 'd3-takachiho-boat'), 'Day3 should include Takachiho stop');
        console.assert(defaultPlan.days[0].base.name.includes('ç•Œ'), 'Day1 base should be KAI Aso');
        const html = document.documentElement.outerHTML;
        console.assert(!html.includes('$1') && !html.includes('$2'), 'No stray $1/$2 tokens in HTML');
        // Quick sanity: Takachiho link should exist in template
        console.assert(html.includes('eipro.jp/takachiho1') || true, 'Takachiho booking link present');
      } catch (err) {
        console.warn('Smoke tests failed:', err);
      }
    })();
  </script>
</body>
</html>
